(()=>{"use strict";const e=(()=>{const e=e=>`${e.slice(0,1)},${e.slice(1,2)}`,t=(e,t,r)=>{const s=document.getElementsByClassName(e)[t-1];s&&(s.style.border=`1px solid ${r}`)};return{isTargetInArray:(e,t)=>{let r=!1;if(JSON.stringify(e)===JSON.stringify(t)&&(r=!0),!e)return r;if(!t)return r;for(let s=0;s<e.length;s++){const n=e[s];JSON.stringify(n)===JSON.stringify(t)&&(r=!0)}return r},changeCoordColor:t,indicateSunk:(r,s)=>{const{currentCoords:n}=r;if("number"==typeof n[0])t(e(n),s,"red");else for(let r=0;r<n.length;r++)t(e(n[r]),s,"red")},classToArray:e=>{const t=[],r=e.slice(0,1),s=e.slice(2,3);return t.push(Number(r)),t.push(Number(s)),t},coordToClass:e}})(),t=(()=>{const t=(e,t,r)=>{let s=t;const n=e;return{isSunk:()=>n===s,hit:()=>s++,currentHits:()=>s,currentCoords:r,shipLength:n}};return{Ship:t,Gameboard:()=>{const r=[],s=[];return{receiveAttack:(t,n)=>{const o=Object.entries(n.coordinates);r.push(t);for(let r=0;r<o.length;r++){let c=!1;const a=o[r][1],i=o[r][0];if(e.isTargetInArray(a,t)){if(c=!0,s.push(t),"carrier"===i&&(n.carrier.hit(),n.carrier.isSunk()))return n.carrier;if("battleShip"===i&&(n.battleShip.hit(),n.battleShip.isSunk()))return n.battleShip;if("battleShip1"===i&&(n.battleShip1.hit(),n.battleShip1.isSunk()))return n.battleShip1;if("cruiser"===i&&(n.cruiser.hit(),n.cruiser.isSunk()))return n.cruiser;if("cruiser1"===i&&(n.cruiser1.hit(),n.cruiser1.isSunk()))return n.cruiser1;if("cruiser2"===i&&(n.cruiser2.hit(),n.cruiser2.isSunk()))return n.cruiser2;if("destroyer"===i&&(n.destroyer.hit(),n.destroyer.isSunk()))return n.destroyer;if("destroyer1"===i&&(n.destroyer1.hit(),n.destroyer1.isSunk()))return n.destroyer1;if("destroyer2"===i&&(n.destroyer2.hit(),n.destroyer2.isSunk()))return n.destroyer2;if("destroyer3"===i&&(n.destroyer3.hit(),n.destroyer3.isSunk()))return n.destroyer3}if(!0===c)break}},deployShips:(e,r,s,n,o,c,a,i,d,l)=>{const u={carrier:e,battleShip:r,battleShip1:s,cruiser:n,cruiser1:o,cruiser2:c,destroyer:a,destroyer1:i,destroyer2:d,destroyer3:l};return{carrier:t(4,0,u.carrier),battleShip:t(3,0,u.battleShip),battleShip1:t(3,0,u.battleShip1),cruiser:t(2,0,u.cruiser),cruiser1:t(2,0,u.cruiser1),cruiser2:t(2,0,u.cruiser2),destroyer:t(1,0,u.destroyer),destroyer1:t(1,0,u.destroyer1),destroyer2:t(1,0,u.destroyer2),destroyer3:t(1,0,u.destroyer3),coordinates:u}},receivedAttacks:r,successAttacks:s,checkSunk:e=>{return!((t=e).carrier.currentCoords&&!t.carrier.isSunk()||t.battleShip.currentCoords&&!t.battleShip.isSunk()||t.battleShip1.currentCoords&&!t.battleShip1.isSunk()||t.cruiser.currentCoords&&!t.cruiser.isSunk()||t.cruiser1.currentCoords&&!t.cruiser1.isSunk()||t.cruiser2.currentCoords&&!t.cruiser2.isSunk()||t.destroyer.currentCoords&&!t.destroyer.isSunk()||t.destroyer1.currentCoords&&!t.destroyer1.isSunk()||t.destroyer2.currentCoords&&!t.destroyer2.isSunk()||t.destroyer3.currentCoords&&!t.destroyer3.isSunk());var t}}}}})(),r=(()=>{const r=(e,t,r)=>{let s=0;"cpu"===r&&(s=1);const n=document.getElementsByClassName(e)[s];n&&(n.textContent=!1===t?"â€¢":"X")},s=(t,r)=>{let s=0;"cpu"===r&&(s=1);const n=e.coordToClass(t),o=document.getElementsByClassName(n)[s];o&&o.replaceWith(o.cloneNode(!0))},n=e=>{const t=[];for(let s=0;s<e.length;s++)(r=e[s])[0]<0||r[1]<0||r[0]>9||r[1]>9||t.push(e[s]);var r;return t},o=e=>{const t=[],r=[e[0]-1,e[1]],s=[e[0]+1,e[1]],n=[e[0],e[1]+1],o=[e[0],e[1]-1];return t.push(r,s,n,o),t},c=(t,c,a,i,d)=>{const l=[];if("object"==typeof t[0])for(let e=0;e<t.length;e++)l.push(o(t[e]));else l.push(o(t));const u=n(l.flat());for(let t=0;t<u.length;t++)e.isTargetInArray(d,u[t])||(r(u[t],!1,i),s(u[t],i),c(u[t],a))},a=e=>{const t=[],r=[e[0]+1,e[1]+1],s=[e[0]+1,e[1]+-1],n=[e[0]-1,e[1]+1],o=[e[0]-1,e[1]-1];return t.push(r,s,n,o),t},i=(e,t,o)=>{const c=a(e),i=n(c);for(let e=0;e<i.length;e++)r(i[e],!1,o),s(i[e],o),t(i[e],!0)};return{Player:(r,s)=>{const n=r,o=s,a=t.Gameboard(),i=a.deployShips(...s);return{playerName:n,playerCoords:o,playerBoard:a,playerShips:i,receiveAttack:t=>{const r=a.receiveAttack(t,i);r&&(e.indicateSunk(r,1),c(r.currentCoords,a.receiveAttack,i,"player",a.successAttacks))}}},cpuPlayer:(s,n)=>{const o=s,a=n,d=t.Gameboard(),l=d.deployShips(...n),u=[],p=(t,s)=>{const n=e=>Math.floor(Math.random()*e),c=[n(10),n(10)];if(e.isTargetInArray(u,c)&&!0!==s)return p();return(t=>{o.receiveAttack(t),u.push(t);const s=o.playerBoard.successAttacks;return e.isTargetInArray(s,t)?(r(t,!0,"player"),i(t,p,"player"),t):r(t,!1,"player")})(t||c)};return{attackPlayer:p,cpuBoard:d,cpuShips:l,cpuCoords:a,usedCoords:u,receiveAttack:t=>{const r=d.receiveAttack(t,l);r&&(e.indicateSunk(r,2),c(r.currentCoords,d.receiveAttack,l,"cpu",d.successAttacks))}}},visualIndicators:r,attackCorners:i,attackAround:c,returnCorners:a,returnSides:o,validateCoords:n}})(),s=(e,t,s)=>{const n=r.Player(e,t);return{Player:n,cpuPlayer:r.cpuPlayer(n,s)}},n=(()=>{const t=(t,s)=>{const n=s.Player.playerShips.coordinates,o=s.cpuPlayer.cpuShips.coordinates,c=e=>s.Player.receiveAttack(e),a=e=>s.cpuPlayer.receiveAttack(e),i=(t,r,s)=>{let n=!1;if(e.isTargetInArray(Object.values(t),r))return s(r),n=!0,!0;for(let o=0;o<t.length;o++){const c=t[o];if(e.isTargetInArray(c,r)){s(r),n=!0;break}}return n},d=(e,t)=>(t(e),!1),l=t=>{const s=t.target.parentElement.className,l=t.target.className,u=e.classToArray(l);if("grid-1"===s){const e=Object.values(n).filter((e=>void 0!==e));!0===i(e,u,c)?(r.visualIndicators(l,!0,"player"),r.attackCorners(u,c,"player")):(d(u,c),r.visualIndicators(l,!1,"player"))}if("grid-2"===s){const e=Object.values(o).filter((e=>void 0!==e));!0===i(e,u,a)?(r.visualIndicators(l,!0,"cpu"),r.attackCorners(u,a,"cpu")):(d(u,a),r.visualIndicators(l,!1,"cpu"))}};for(let e=0;e<t.length;e++)t[e].addEventListener("click",l,{once:!0})};return{startGame:(e,r,n,o)=>{const c=s("example",n,o);return"shown-grid"!==e.className&&t(e.childNodes,c),"shown-grid"!==r.className&&t(r.childNodes,c),{currentGame:c,gridContainer1:e,gridContainer2:r}},displayGrid:(e,t)=>{(r=>{const s=r=>{if(10!==r){for(let s=0;s<10;s++){const n=document.createElement("div");n.className=`${r},${s}`;const o=document.createElement("div");o.className=`${r},${s}`,e&&e.appendChild(n),t&&t.appendChild(o)}s(r+1)}};s(0)})()},genDOMElements:()=>({genGrid:(t,r)=>{const s=document.createElement("section");s.className="grids-container";const o=document.querySelector("main");o&&o.appendChild(s);const c=document.createElement("h3");c.textContent=`Player's ${t} Grid`,s.appendChild(c);const a=document.createElement("div");a.className="grid-wrapper",((e,t)=>{const r=document.createElement("section"),s=document.createElement("section");r.classList.add("X"),s.classList.add("Y");const n=["A","B","C","D","E","F","G","H","I","J"];for(let e=1;e<=10;e++){const t=document.createElement("div");t.textContent=e,s.appendChild(t);const o=document.createElement("div");o.textContent=n[e-1],r.appendChild(o)}e.appendChild(r),t.appendChild(s)})(s,a),s.appendChild(a);const i=document.createElement("div");return i.className=`grid-${t}`,a.appendChild(i),1===t?n.displayGrid(i,null):n.displayGrid(null,i),r&&(i.className="shown-grid",((t,r)=>{const s=(e=>{const t=[];for(let r=0;r<e.length;r++){const s=e[r];"object"==typeof s[0]?t.push(...s):t.push(s)}return t})(t);for(let t=0;t<s.length;t++)e.changeCoordColor(e.coordToClass(s[t]),r,"green")})(r,t)),i},deleteElements:e=>{const t=document.getElementsByClassName("grids-container")[e];t&&t.remove()},genStartButton:()=>{const e=document.createElement("button");e.className="start-button",e.textContent="Start Game";const t=document.getElementsByClassName("grids-container")[0];t&&t.appendChild(e)},genRandomizeButton:()=>{const e=document.createElement("button");e.className="random-button",e.textContent="Randomize Coordinates";const t=document.getElementsByClassName("grids-container")[0];t&&t.appendChild(e)}}),endGame:e=>{const t=document.getElementsByClassName("grid-1")[0],r=document.getElementsByClassName("grid-2")[0];t&&t.replaceWith(t.cloneNode(!0)),r&&r.replaceWith(r.cloneNode(!0)),(e=>{const t=document.querySelector("body"),r=document.createElement("dialog");r.classList.add("modal"),t.appendChild(r);const s=document.createElement("div");r.appendChild(s),s.textContent=`Congratulations ${e}, you won!`;const n=document.createElement("button");n.textContent="New Game",n.addEventListener("click",(()=>window.location.reload())),r.appendChild(n),r.showModal()})(e)}}})();(()=>{const t=()=>{const t=e=>{const t=e=>{const t=[...r.returnCorners(e),...r.returnSides(e),e];return r.validateCoords(t)},s=[];if("object"!=typeof e[0]){const r=t(e);return s.push(...r),s}for(let r=0;r<e.length;r++){const n=t(e[r]);s.push(...n)}return[...new Set(s)]},s=e=>Math.floor(Math.random()*e),n=(e,t,r)=>{if(r){const t=[r[0]+1,r[1]],s=[r[0],r[1]+1];return"v"===e?t:s}let n;return n="v"===e?[s(10-t),s(10)]:[s(10),s(10-t)],1===t&&(n=[s(10),s(10)]),n},o=(t,r)=>{const c=[],a=0===s(2)?"h":"v",i=()=>{const s=n(a,t);e.isTargetInArray(r,s)?i():c.push(s)};for(let e=0;e<t;e++){const e=c[c.length-1],r=n(a,t,e);e?c.push(r):i()}if(1!==c.length){let s=!0;for(let t=0;t<c.length;t++){const n=c[t];e.isTargetInArray(r,n)&&(s=!1)}return!1===s?o(t,r):c}return c[0]};return{genBattleships:()=>{const e=[],r=o(4,e);e.push(...t(r));const s=o(3,e);e.push(...t(s));const n=o(3,e);e.push(...t(n));const c=o(2,e);e.push(...t(c));const a=o(2,e);e.push(...t(a));const i=o(2,e);e.push(...t(i));const d=o(1,e);e.push(...t(d));const l=o(1,e);e.push(...t(l));const u=o(1,e);e.push(...t(u));const p=o(1,e);return e.push(...t(p)),{coords:[r,s,n,c,a,i,d,l,u,p],usedCoords:e}},genShipCoord:o,surroundCoords:t}},s=n.genDOMElements(),o=(e,r)=>{let o;if(s.deleteElements(0),!0!==r){const r=t().genBattleships().coords;o=n.startGame(s.genGrid(1,e),s.genGrid(2),e,r)}else o=n.startGame(s.genGrid(1,e),s.genGrid(2),e,e);const c=o.currentGame.Player,a=o.currentGame.cpuPlayer,i=((e,t)=>{const r=e.playerShips,s=t.cpuShips;return{turnsLogic:()=>{let o=!1;return t.attackPlayer(),e.playerBoard.checkSunk(r)&&(n.endGame("Player1"),o=!0),t.cpuBoard.checkSunk(s)&&(n.endGame("Player2"),o=!0),o}}})(c,a);return((e,t)=>{for(let r=0;r<t.childNodes.length;r++)t.childNodes[r].addEventListener("click",(()=>{e.turnsLogic()}),{once:!0})})(i,o.gridContainer2),{playerObj:c,cpuObj:a,currentTurn:i}},c=(e,r)=>{s.genGrid(1,e),s.genStartButton(),s.genRandomizeButton();const n=document.getElementsByClassName("start-button")[0],a=document.getElementsByClassName("random-button")[0];a&&a.addEventListener("click",(()=>{s.deleteElements(0),c(t().genBattleships().coords)})),n&&n.addEventListener("click",(()=>{o(e,r)}))};return{singlePlayer:o,setupDOM:()=>{const e=t().genBattleships().coords;c(e,!0)},genCoords:t,genInitialElements:c}})().setupDOM()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YSxFQXVDckNXLEVBQXFCLENBQUNsTixFQUFRbU0sS0FDbENGLEVBQU9yRCxRQUFRLEVBQUc1SSxHQUNsQmlNLEVBQU9oQyxpQkFDUGdDLEVBQU85QixxQkFHUCxNQUtNRCxFQUFjNUwsU0FBU0MsdUJBQXVCLGdCQUFnQixHQUM5RDRPLEVBQWtCN08sU0FBU0MsdUJBQXVCLGlCQUFpQixHQUVyRTRPLEdBQ0ZBLEVBQWdCMUYsaUJBQWlCLFNBQVMsS0FSMUN3RSxFQUFPbEMsZUFTUyxHQVJoQm1ELEVBQW1CaEMsSUFBWWMsaUJBQWlCaE0sT0FROUIsSUFHaEJrSyxHQUNGQSxFQUFZekMsaUJBQWlCLFNBQVMsS0FDcEN5RSxFQUFhbE0sRUFBUW1NLEVBQVcsR0FDaEMsRUFRTixNQUFPLENBQUVELGVBQWNrQixTQUxOLEtBQ2YsTUFBTWxILEVBQWVnRixJQUFZYyxpQkFBaUJoTSxPQUNsRGtOLEVBQW1CaEgsR0FBYyxFQUFLLEVBR1BnRixZQUFXZ0MscUJBQzdDLEVBN1NnQixHQStTUkUsVSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZ2xvYmFsTG9naWMgPSAoKCkgPT4ge1xuICAvLyB0aGVzZSBmdW5jdGlvbnMgYXJlIHVzZWQgaW4gYWxtb3N0IGV2ZXJ5IG90aGVyIG1vZHVsZSwgc28gaSBuZWVkIHRvIGhhdmUgdGhlbSBoZXJlIGluIG9yZGVyIHRvIGludm9rZSB0aGVtLlxuXG4gIGNvbnN0IGlzVGFyZ2V0SW5BcnJheSA9IChhcnIsIHRhcmdldCkgPT4ge1xuICAgIGxldCBjb250YWlucyA9IGZhbHNlO1xuXG4gICAgaWYgKEpTT04uc3RyaW5naWZ5KGFycikgPT09IEpTT04uc3RyaW5naWZ5KHRhcmdldCkpIGNvbnRhaW5zID0gdHJ1ZTtcblxuICAgIGlmICghYXJyKSByZXR1cm4gY29udGFpbnM7XG5cbiAgICBpZiAoIXRhcmdldCkgcmV0dXJuIGNvbnRhaW5zO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBhcnJbaV07XG5cbiAgICAgIGlmIChKU09OLnN0cmluZ2lmeShlbGVtZW50KSA9PT0gSlNPTi5zdHJpbmdpZnkodGFyZ2V0KSkgY29udGFpbnMgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBjb250YWlucztcbiAgfTtcblxuICBjb25zdCBjbGFzc1RvQXJyYXkgPSAoY2xhc3NDb29yZCkgPT4ge1xuICAgIGNvbnN0IGFycmF5Q29vcmQgPSBbXTtcblxuICAgIGNvbnN0IHggPSBjbGFzc0Nvb3JkLnNsaWNlKDAsIDEpO1xuICAgIGNvbnN0IHkgPSBjbGFzc0Nvb3JkLnNsaWNlKDIsIDMpO1xuXG4gICAgYXJyYXlDb29yZC5wdXNoKE51bWJlcih4KSk7XG4gICAgYXJyYXlDb29yZC5wdXNoKE51bWJlcih5KSk7XG5cbiAgICByZXR1cm4gYXJyYXlDb29yZDtcbiAgfTtcblxuICBjb25zdCBjb29yZFRvQ2xhc3MgPSAoYXJyKSA9PiBgJHthcnIuc2xpY2UoMCwgMSl9LCR7YXJyLnNsaWNlKDEsIDIpfWA7XG5cbiAgY29uc3QgY2hhbmdlQ29vcmRDb2xvciA9IChjbGFzc05hbWUsIGdyaWROdW1iZXIsIGNvbG9yKSA9PiB7XG4gICAgY29uc3QgY3VycmVudENvb3JkID1cbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKVtncmlkTnVtYmVyIC0gMV07XG5cbiAgICBpZiAoY3VycmVudENvb3JkKSBjdXJyZW50Q29vcmQuc3R5bGUuYm9yZGVyID0gYDFweCBzb2xpZCAke2NvbG9yfWA7XG4gIH07XG5cbiAgY29uc3QgaW5kaWNhdGVTdW5rID0gKHNoaXAsIGdyaWROdW1iZXIpID0+IHtcbiAgICBjb25zdCB7IGN1cnJlbnRDb29yZHMgfSA9IHNoaXA7XG5cbiAgICBpZiAodHlwZW9mIGN1cnJlbnRDb29yZHNbMF0gPT09IFwibnVtYmVyXCIpXG4gICAgICAvLyB3aGVuIHRoZSBzaGlwIG9ubHkgaGFzIG9uZSBjb29yZGluYXRlLlxuICAgICAgY2hhbmdlQ29vcmRDb2xvcihjb29yZFRvQ2xhc3MoY3VycmVudENvb3JkcyksIGdyaWROdW1iZXIsIFwicmVkXCIpO1xuICAgIGVsc2VcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VycmVudENvb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjaGFuZ2VDb29yZENvbG9yKGNvb3JkVG9DbGFzcyhjdXJyZW50Q29vcmRzW2ldKSwgZ3JpZE51bWJlciwgXCJyZWRcIik7XG4gICAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBpc1RhcmdldEluQXJyYXksXG4gICAgY2hhbmdlQ29vcmRDb2xvcixcbiAgICBpbmRpY2F0ZVN1bmssXG4gICAgY2xhc3NUb0FycmF5LFxuICAgIGNvb3JkVG9DbGFzcyxcbiAgfTtcbn0pKCk7XG5cbmNvbnN0IG1haW5PYmplY3RzID0gKCgpID0+IHtcbiAgY29uc3QgU2hpcCA9IChsZW5ndGhOdW1iZXIsIGhpdHNOdW1iZXIsIGNvb3JkcykgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRDb29yZHMgPSBjb29yZHM7XG5cbiAgICBjb25zdCBjaGVja1N1bmsgPSAobGVuZ3RoLCBoaXRzKSA9PiB7XG4gICAgICBpZiAobGVuZ3RoID09PSBoaXRzKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgbGV0IHNoaXBIaXRzID0gaGl0c051bWJlcjtcblxuICAgIGNvbnN0IHNoaXBMZW5ndGggPSBsZW5ndGhOdW1iZXI7XG5cbiAgICBjb25zdCBpc1N1bmsgPSAoKSA9PiBjaGVja1N1bmsoc2hpcExlbmd0aCwgc2hpcEhpdHMpO1xuXG4gICAgY29uc3QgaGl0ID0gKCkgPT4gc2hpcEhpdHMrKztcblxuICAgIGNvbnN0IGN1cnJlbnRIaXRzID0gKCkgPT4gc2hpcEhpdHM7XG5cbiAgICByZXR1cm4geyBpc1N1bmssIGhpdCwgY3VycmVudEhpdHMsIGN1cnJlbnRDb29yZHMsIHNoaXBMZW5ndGggfTtcbiAgfTtcblxuICBjb25zdCBHYW1lYm9hcmQgPSAoKSA9PiB7XG4gICAgY29uc3QgZGVwbG95U2hpcHMgPSAoXG4gICAgICBjYXJyaWVyQ29yZHMsXG4gICAgICBiYXR0bGVTaGlwQ29yZHMsXG4gICAgICBiYXR0bGVTaGlwMUNvcmRzLFxuICAgICAgY3J1aXNlckNvcmRzLFxuICAgICAgY3J1aXNlcjFDb3JkcyxcbiAgICAgIGNydWlzZXIyQ29yZHMsXG4gICAgICBkZXN0cm95ZXJDb3JkcyxcbiAgICAgIGRlc3Ryb3llcjFDb3JkcyxcbiAgICAgIGRlc3Ryb3llcjJDb3JkcyxcbiAgICAgIGRlc3Ryb3llcjNDb3Jkc1xuICAgICkgPT4ge1xuICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSB7XG4gICAgICAgIGNhcnJpZXI6IGNhcnJpZXJDb3JkcyxcbiAgICAgICAgYmF0dGxlU2hpcDogYmF0dGxlU2hpcENvcmRzLFxuICAgICAgICBiYXR0bGVTaGlwMTogYmF0dGxlU2hpcDFDb3JkcyxcbiAgICAgICAgY3J1aXNlcjogY3J1aXNlckNvcmRzLFxuICAgICAgICBjcnVpc2VyMTogY3J1aXNlcjFDb3JkcyxcbiAgICAgICAgY3J1aXNlcjI6IGNydWlzZXIyQ29yZHMsXG4gICAgICAgIGRlc3Ryb3llcjogZGVzdHJveWVyQ29yZHMsXG4gICAgICAgIGRlc3Ryb3llcjE6IGRlc3Ryb3llcjFDb3JkcyxcbiAgICAgICAgZGVzdHJveWVyMjogZGVzdHJveWVyMkNvcmRzLFxuICAgICAgICBkZXN0cm95ZXIzOiBkZXN0cm95ZXIzQ29yZHMsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjYXJyaWVyID0gU2hpcCg0LCAwLCBjb29yZGluYXRlcy5jYXJyaWVyKTtcblxuICAgICAgY29uc3QgYmF0dGxlU2hpcCA9IFNoaXAoMywgMCwgY29vcmRpbmF0ZXMuYmF0dGxlU2hpcCk7XG5cbiAgICAgIGNvbnN0IGJhdHRsZVNoaXAxID0gU2hpcCgzLCAwLCBjb29yZGluYXRlcy5iYXR0bGVTaGlwMSk7XG5cbiAgICAgIGNvbnN0IGNydWlzZXIgPSBTaGlwKDIsIDAsIGNvb3JkaW5hdGVzLmNydWlzZXIpO1xuXG4gICAgICBjb25zdCBjcnVpc2VyMSA9IFNoaXAoMiwgMCwgY29vcmRpbmF0ZXMuY3J1aXNlcjEpO1xuXG4gICAgICBjb25zdCBjcnVpc2VyMiA9IFNoaXAoMiwgMCwgY29vcmRpbmF0ZXMuY3J1aXNlcjIpO1xuXG4gICAgICBjb25zdCBkZXN0cm95ZXIgPSBTaGlwKDEsIDAsIGNvb3JkaW5hdGVzLmRlc3Ryb3llcik7XG5cbiAgICAgIGNvbnN0IGRlc3Ryb3llcjEgPSBTaGlwKDEsIDAsIGNvb3JkaW5hdGVzLmRlc3Ryb3llcjEpO1xuXG4gICAgICBjb25zdCBkZXN0cm95ZXIyID0gU2hpcCgxLCAwLCBjb29yZGluYXRlcy5kZXN0cm95ZXIyKTtcblxuICAgICAgY29uc3QgZGVzdHJveWVyMyA9IFNoaXAoMSwgMCwgY29vcmRpbmF0ZXMuZGVzdHJveWVyMyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhcnJpZXIsXG4gICAgICAgIGJhdHRsZVNoaXAsXG4gICAgICAgIGJhdHRsZVNoaXAxLFxuICAgICAgICBjcnVpc2VyLFxuICAgICAgICBjcnVpc2VyMSxcbiAgICAgICAgY3J1aXNlcjIsXG4gICAgICAgIGRlc3Ryb3llcixcbiAgICAgICAgZGVzdHJveWVyMSxcbiAgICAgICAgZGVzdHJveWVyMixcbiAgICAgICAgZGVzdHJveWVyMyxcbiAgICAgICAgY29vcmRpbmF0ZXMsXG4gICAgICB9O1xuICAgIH07XG5cbiAgICBjb25zdCByZWNlaXZlZEF0dGFja3MgPSBbXTtcblxuICAgIGNvbnN0IHN1Y2Nlc3NBdHRhY2tzID0gW107XG5cbiAgICBjb25zdCByZWNlaXZlQXR0YWNrID0gKHRhcmdldENvcmRzLCBwbGF5ZXJTaGlwcykgPT4ge1xuICAgICAgY29uc3QgY3VycmVudFNoaXBzID0gT2JqZWN0LmVudHJpZXMocGxheWVyU2hpcHMuY29vcmRpbmF0ZXMpO1xuICAgICAgcmVjZWl2ZWRBdHRhY2tzLnB1c2godGFyZ2V0Q29yZHMpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1cnJlbnRTaGlwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgc3VjY2VzcyA9IGZhbHNlO1xuXG4gICAgICAgIGNvbnN0IHNoaXBDb3JkcyA9IGN1cnJlbnRTaGlwc1tpXVsxXTtcblxuICAgICAgICBjb25zdCBzaGlwTmFtZSA9IGN1cnJlbnRTaGlwc1tpXVswXTtcblxuICAgICAgICBpZiAoZ2xvYmFsTG9naWMuaXNUYXJnZXRJbkFycmF5KHNoaXBDb3JkcywgdGFyZ2V0Q29yZHMpKSB7XG4gICAgICAgICAgc3VjY2VzcyA9IHRydWU7XG5cbiAgICAgICAgICBzdWNjZXNzQXR0YWNrcy5wdXNoKHRhcmdldENvcmRzKTtcblxuICAgICAgICAgIC8vIGlmIHRoZSB0YXJnZXQgY29yZHMgbWF0Y2hlcyBhIHNoaXAgY29yZHMuXG4gICAgICAgICAgaWYgKHNoaXBOYW1lID09PSBcImNhcnJpZXJcIikge1xuICAgICAgICAgICAgcGxheWVyU2hpcHMuY2Fycmllci5oaXQoKTtcbiAgICAgICAgICAgIGlmIChwbGF5ZXJTaGlwcy5jYXJyaWVyLmlzU3VuaygpKSByZXR1cm4gcGxheWVyU2hpcHMuY2FycmllcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNoaXBOYW1lID09PSBcImJhdHRsZVNoaXBcIikge1xuICAgICAgICAgICAgcGxheWVyU2hpcHMuYmF0dGxlU2hpcC5oaXQoKTtcbiAgICAgICAgICAgIGlmIChwbGF5ZXJTaGlwcy5iYXR0bGVTaGlwLmlzU3VuaygpKSByZXR1cm4gcGxheWVyU2hpcHMuYmF0dGxlU2hpcDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNoaXBOYW1lID09PSBcImJhdHRsZVNoaXAxXCIpIHtcbiAgICAgICAgICAgIHBsYXllclNoaXBzLmJhdHRsZVNoaXAxLmhpdCgpO1xuICAgICAgICAgICAgaWYgKHBsYXllclNoaXBzLmJhdHRsZVNoaXAxLmlzU3VuaygpKVxuICAgICAgICAgICAgICByZXR1cm4gcGxheWVyU2hpcHMuYmF0dGxlU2hpcDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzaGlwTmFtZSA9PT0gXCJjcnVpc2VyXCIpIHtcbiAgICAgICAgICAgIHBsYXllclNoaXBzLmNydWlzZXIuaGl0KCk7XG4gICAgICAgICAgICBpZiAocGxheWVyU2hpcHMuY3J1aXNlci5pc1N1bmsoKSkgcmV0dXJuIHBsYXllclNoaXBzLmNydWlzZXI7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzaGlwTmFtZSA9PT0gXCJjcnVpc2VyMVwiKSB7XG4gICAgICAgICAgICBwbGF5ZXJTaGlwcy5jcnVpc2VyMS5oaXQoKTtcbiAgICAgICAgICAgIGlmIChwbGF5ZXJTaGlwcy5jcnVpc2VyMS5pc1N1bmsoKSkgcmV0dXJuIHBsYXllclNoaXBzLmNydWlzZXIxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2hpcE5hbWUgPT09IFwiY3J1aXNlcjJcIikge1xuICAgICAgICAgICAgcGxheWVyU2hpcHMuY3J1aXNlcjIuaGl0KCk7XG4gICAgICAgICAgICBpZiAocGxheWVyU2hpcHMuY3J1aXNlcjIuaXNTdW5rKCkpIHJldHVybiBwbGF5ZXJTaGlwcy5jcnVpc2VyMjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNoaXBOYW1lID09PSBcImRlc3Ryb3llclwiKSB7XG4gICAgICAgICAgICBwbGF5ZXJTaGlwcy5kZXN0cm95ZXIuaGl0KCk7XG4gICAgICAgICAgICBpZiAocGxheWVyU2hpcHMuZGVzdHJveWVyLmlzU3VuaygpKSByZXR1cm4gcGxheWVyU2hpcHMuZGVzdHJveWVyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2hpcE5hbWUgPT09IFwiZGVzdHJveWVyMVwiKSB7XG4gICAgICAgICAgICBwbGF5ZXJTaGlwcy5kZXN0cm95ZXIxLmhpdCgpO1xuICAgICAgICAgICAgaWYgKHBsYXllclNoaXBzLmRlc3Ryb3llcjEuaXNTdW5rKCkpIHJldHVybiBwbGF5ZXJTaGlwcy5kZXN0cm95ZXIxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2hpcE5hbWUgPT09IFwiZGVzdHJveWVyMlwiKSB7XG4gICAgICAgICAgICBwbGF5ZXJTaGlwcy5kZXN0cm95ZXIyLmhpdCgpO1xuICAgICAgICAgICAgaWYgKHBsYXllclNoaXBzLmRlc3Ryb3llcjIuaXNTdW5rKCkpIHJldHVybiBwbGF5ZXJTaGlwcy5kZXN0cm95ZXIyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2hpcE5hbWUgPT09IFwiZGVzdHJveWVyM1wiKSB7XG4gICAgICAgICAgICBwbGF5ZXJTaGlwcy5kZXN0cm95ZXIzLmhpdCgpO1xuICAgICAgICAgICAgaWYgKHBsYXllclNoaXBzLmRlc3Ryb3llcjMuaXNTdW5rKCkpIHJldHVybiBwbGF5ZXJTaGlwcy5kZXN0cm95ZXIzO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdWNjZXNzID09PSB0cnVlKSBicmVhaztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgY2hlY2tTdW5rID0gKHBsYXllclNoaXBzKSA9PiB7XG4gICAgICBjb25zdCBhcmVBbGxTdW5rID0gKHNoaXBzKSA9PiB7XG4gICAgICAgIC8vIGVpdGhlciB3ZSBkaWRuJ3QgZGVmaW5lZCB0aGUgY29yZHMgb2YgYSBzaGlwICh1bmRlZmluZWQpLCBvciBpdCBpcyBhY3R1YWxseSBzdW5rLCB3ZSB0YWtlIHRoYXQgYXMgdHJ1ZS5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICghc2hpcHMuY2Fycmllci5jdXJyZW50Q29vcmRzIHx8IHNoaXBzLmNhcnJpZXIuaXNTdW5rKCkpICYmXG4gICAgICAgICAgKCFzaGlwcy5iYXR0bGVTaGlwLmN1cnJlbnRDb29yZHMgfHwgc2hpcHMuYmF0dGxlU2hpcC5pc1N1bmsoKSkgJiZcbiAgICAgICAgICAoIXNoaXBzLmJhdHRsZVNoaXAxLmN1cnJlbnRDb29yZHMgfHwgc2hpcHMuYmF0dGxlU2hpcDEuaXNTdW5rKCkpICYmXG4gICAgICAgICAgKCFzaGlwcy5jcnVpc2VyLmN1cnJlbnRDb29yZHMgfHwgc2hpcHMuY3J1aXNlci5pc1N1bmsoKSkgJiZcbiAgICAgICAgICAoIXNoaXBzLmNydWlzZXIxLmN1cnJlbnRDb29yZHMgfHwgc2hpcHMuY3J1aXNlcjEuaXNTdW5rKCkpICYmXG4gICAgICAgICAgKCFzaGlwcy5jcnVpc2VyMi5jdXJyZW50Q29vcmRzIHx8IHNoaXBzLmNydWlzZXIyLmlzU3VuaygpKSAmJlxuICAgICAgICAgICghc2hpcHMuZGVzdHJveWVyLmN1cnJlbnRDb29yZHMgfHwgc2hpcHMuZGVzdHJveWVyLmlzU3VuaygpKSAmJlxuICAgICAgICAgICghc2hpcHMuZGVzdHJveWVyMS5jdXJyZW50Q29vcmRzIHx8IHNoaXBzLmRlc3Ryb3llcjEuaXNTdW5rKCkpICYmXG4gICAgICAgICAgKCFzaGlwcy5kZXN0cm95ZXIyLmN1cnJlbnRDb29yZHMgfHwgc2hpcHMuZGVzdHJveWVyMi5pc1N1bmsoKSkgJiZcbiAgICAgICAgICAoIXNoaXBzLmRlc3Ryb3llcjMuY3VycmVudENvb3JkcyB8fCBzaGlwcy5kZXN0cm95ZXIzLmlzU3VuaygpKVxuICAgICAgICApXG4gICAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIGFyZUFsbFN1bmsocGxheWVyU2hpcHMpO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgcmVjZWl2ZUF0dGFjayxcbiAgICAgIGRlcGxveVNoaXBzLFxuICAgICAgcmVjZWl2ZWRBdHRhY2tzLFxuICAgICAgc3VjY2Vzc0F0dGFja3MsXG4gICAgICBjaGVja1N1bmssXG4gICAgfTtcbiAgfTtcblxuICByZXR1cm4geyBTaGlwLCBHYW1lYm9hcmQgfTtcbn0pKCk7XG5cbmNvbnN0IHBsYXllckxvZ2ljID0gKCgpID0+IHtcbiAgY29uc3QgdmlzdWFsSW5kaWNhdG9ycyA9IChjb29yZCwgd2FzU3VjY2Vzc2Z1bCwgdGFyZ2V0KSA9PiB7XG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBpZiAodGFyZ2V0ID09PSBcImNwdVwiKSBpbmRleCA9IDE7XG5cbiAgICBjb25zdCBjdXJyZW50Tm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY29vcmQpW2luZGV4XTtcblxuICAgIGlmIChjdXJyZW50Tm9kZSkge1xuICAgICAgaWYgKHdhc1N1Y2Nlc3NmdWwgPT09IGZhbHNlKSBjdXJyZW50Tm9kZS50ZXh0Q29udGVudCA9IFwi4oCiXCI7XG4gICAgICBlbHNlIHtcbiAgICAgICAgY3VycmVudE5vZGUudGV4dENvbnRlbnQgPSBcIlhcIjtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcmVtb3ZlTm9kZUxpc3RlbmVycyA9IChjb29yZCwgdGFyZ2V0KSA9PiB7XG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBpZiAodGFyZ2V0ID09PSBcImNwdVwiKSBpbmRleCA9IDE7XG5cbiAgICBjb25zdCBjb29yZGluYXRlID0gZ2xvYmFsTG9naWMuY29vcmRUb0NsYXNzKGNvb3JkKTtcblxuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNvb3JkaW5hdGUpW2luZGV4XTtcblxuICAgIGlmIChlbGVtZW50KSBlbGVtZW50LnJlcGxhY2VXaXRoKGVsZW1lbnQuY2xvbmVOb2RlKHRydWUpKTtcbiAgfTtcblxuICBjb25zdCB2YWxpZGF0ZUNvb3JkID0gKGNvb3JkKSA9PiB7XG4gICAgaWYgKGNvb3JkWzBdIDwgMCB8fCBjb29yZFsxXSA8IDAgfHwgY29vcmRbMF0gPiA5IHx8IGNvb3JkWzFdID4gOSlcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICBjb25zdCB2YWxpZGF0ZUNvb3JkcyA9IChjb29yZHMpID0+IHtcbiAgICBjb25zdCB2YWxpZGF0ZWRDb29yZHMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHZhbGlkYXRlQ29vcmQoY29vcmRzW2ldKSkgdmFsaWRhdGVkQ29vcmRzLnB1c2goY29vcmRzW2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbGlkYXRlZENvb3JkcztcbiAgfTtcblxuICBjb25zdCByZXR1cm5TaWRlcyA9IChub2RlQ29vcmQpID0+IHtcbiAgICBjb25zdCBjb29yZHMgPSBbXTtcblxuICAgIGNvbnN0IHVwID0gW25vZGVDb29yZFswXSAtIDEsIG5vZGVDb29yZFsxXV07XG4gICAgY29uc3QgZG93biA9IFtub2RlQ29vcmRbMF0gKyAxLCBub2RlQ29vcmRbMV1dO1xuICAgIGNvbnN0IHJpZ2h0ID0gW25vZGVDb29yZFswXSwgbm9kZUNvb3JkWzFdICsgMV07XG4gICAgY29uc3QgbGVmdCA9IFtub2RlQ29vcmRbMF0sIG5vZGVDb29yZFsxXSAtIDFdO1xuXG4gICAgY29vcmRzLnB1c2godXAsIGRvd24sIHJpZ2h0LCBsZWZ0KTtcblxuICAgIHJldHVybiBjb29yZHM7XG4gIH07XG5cbiAgY29uc3QgYXR0YWNrQXJvdW5kID0gKFxuICAgIG5vZGVDb29yZHMsXG4gICAgYXR0YWNrRnVuY3Rpb24sXG4gICAgc2hpcHMsXG4gICAgdGFyZ2V0LFxuICAgIHN1Y2Nlc3NBdHRhY2tzXG4gICkgPT4ge1xuICAgIGNvbnN0IGFyb3VuZENvb3JkcyA9IFtdO1xuXG4gICAgaWYgKHR5cGVvZiBub2RlQ29vcmRzWzBdID09PSBcIm9iamVjdFwiKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVDb29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYXJvdW5kQ29vcmRzLnB1c2gocmV0dXJuU2lkZXMobm9kZUNvb3Jkc1tpXSkpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhcm91bmRDb29yZHMucHVzaChyZXR1cm5TaWRlcyhub2RlQ29vcmRzKSk7IC8vIHdoZW4gdGhlIHNoaXAgaGFzIG9ubHkgb25lIGNvb3JkLlxuICAgIH1cblxuICAgIGNvbnN0IGZsYXRDb29yZHMgPSB2YWxpZGF0ZUNvb3Jkcyhhcm91bmRDb29yZHMuZmxhdCgpKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmxhdENvb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFnbG9iYWxMb2dpYy5pc1RhcmdldEluQXJyYXkoc3VjY2Vzc0F0dGFja3MsIGZsYXRDb29yZHNbaV0pKSB7XG4gICAgICAgIC8vIGF2b2lkIG1vZGlmeWluZyBzdWNjZXNzZnVsIGF0dGFja3MuXG4gICAgICAgIHZpc3VhbEluZGljYXRvcnMoZmxhdENvb3Jkc1tpXSwgZmFsc2UsIHRhcmdldCk7XG4gICAgICAgIHJlbW92ZU5vZGVMaXN0ZW5lcnMoZmxhdENvb3Jkc1tpXSwgdGFyZ2V0KTtcbiAgICAgICAgYXR0YWNrRnVuY3Rpb24oZmxhdENvb3Jkc1tpXSwgc2hpcHMpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCByZXR1cm5Db3JuZXJzID0gKG5vZGUpID0+IHtcbiAgICBjb25zdCBjb3JuZXJzID0gW107XG5cbiAgICBjb25zdCBjb3JuZXIxID0gW25vZGVbMF0gKyAxLCBub2RlWzFdICsgMV07XG4gICAgY29uc3QgY29ybmVyMiA9IFtub2RlWzBdICsgMSwgbm9kZVsxXSArIC0xXTtcbiAgICBjb25zdCBjb3JuZXIzID0gW25vZGVbMF0gLSAxLCBub2RlWzFdICsgMV07XG4gICAgY29uc3QgY29ybmVyNCA9IFtub2RlWzBdIC0gMSwgbm9kZVsxXSAtIDFdO1xuXG4gICAgY29ybmVycy5wdXNoKGNvcm5lcjEsIGNvcm5lcjIsIGNvcm5lcjMsIGNvcm5lcjQpO1xuXG4gICAgcmV0dXJuIGNvcm5lcnM7XG4gIH07XG5cbiAgY29uc3QgYXR0YWNrQ29ybmVycyA9IChub2RlQ29vcmQsIGF0dGFja0Z1bmN0aW9uLCB0YXJnZXQpID0+IHtcbiAgICBjb25zdCBjb3JuZXJzID0gcmV0dXJuQ29ybmVycyhub2RlQ29vcmQpO1xuXG4gICAgY29uc3QgdmFsaWRDb3JuZXJzID0gdmFsaWRhdGVDb29yZHMoY29ybmVycyk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbGlkQ29ybmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgdmlzdWFsSW5kaWNhdG9ycyh2YWxpZENvcm5lcnNbaV0sIGZhbHNlLCB0YXJnZXQpO1xuICAgICAgcmVtb3ZlTm9kZUxpc3RlbmVycyh2YWxpZENvcm5lcnNbaV0sIHRhcmdldCk7XG4gICAgICBhdHRhY2tGdW5jdGlvbih2YWxpZENvcm5lcnNbaV0sIHRydWUpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBQbGF5ZXIgPSAobmFtZSwgc2hpcHNDb29yZHMpID0+IHtcbiAgICBjb25zdCBwbGF5ZXJOYW1lID0gbmFtZTtcblxuICAgIGNvbnN0IHBsYXllckNvb3JkcyA9IHNoaXBzQ29vcmRzO1xuXG4gICAgY29uc3QgcGxheWVyQm9hcmQgPSBtYWluT2JqZWN0cy5HYW1lYm9hcmQoKTtcblxuICAgIGNvbnN0IHBsYXllclNoaXBzID0gcGxheWVyQm9hcmQuZGVwbG95U2hpcHMoLi4uc2hpcHNDb29yZHMpO1xuXG4gICAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZHMpID0+IHtcbiAgICAgIGNvbnN0IHJlY2VpdmVkQXR0YWNrID0gcGxheWVyQm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZHMsIHBsYXllclNoaXBzKTtcblxuICAgICAgaWYgKHJlY2VpdmVkQXR0YWNrKSB7XG4gICAgICAgIC8vIGlmIHJlY2VpdmVkQXR0YWNrIGlzIGEgdHJ1ZSB2YWx1ZSwgaXQgbWVhbnMgdGhhdCBpdCBjb250YWlucyBhIHN1bmtlZCBzaGlwLlxuICAgICAgICBnbG9iYWxMb2dpYy5pbmRpY2F0ZVN1bmsocmVjZWl2ZWRBdHRhY2ssIDEpO1xuICAgICAgICBhdHRhY2tBcm91bmQoXG4gICAgICAgICAgcmVjZWl2ZWRBdHRhY2suY3VycmVudENvb3JkcyxcbiAgICAgICAgICBwbGF5ZXJCb2FyZC5yZWNlaXZlQXR0YWNrLFxuICAgICAgICAgIHBsYXllclNoaXBzLFxuICAgICAgICAgIFwicGxheWVyXCIsXG4gICAgICAgICAgcGxheWVyQm9hcmQuc3VjY2Vzc0F0dGFja3NcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHBsYXllck5hbWUsXG4gICAgICBwbGF5ZXJDb29yZHMsXG4gICAgICBwbGF5ZXJCb2FyZCxcbiAgICAgIHBsYXllclNoaXBzLFxuICAgICAgcmVjZWl2ZUF0dGFjayxcbiAgICB9O1xuICB9O1xuXG4gIGNvbnN0IGNwdVBsYXllciA9IChodW1hblBsYXllciwgc2hpcHNDb3JkcykgPT4ge1xuICAgIGNvbnN0IHJpdmFsUGxheWVyID0gaHVtYW5QbGF5ZXI7XG5cbiAgICBjb25zdCBjcHVDb29yZHMgPSBzaGlwc0NvcmRzO1xuXG4gICAgY29uc3QgY3B1Qm9hcmQgPSBtYWluT2JqZWN0cy5HYW1lYm9hcmQoKTtcblxuICAgIGNvbnN0IGNwdVNoaXBzID0gY3B1Qm9hcmQuZGVwbG95U2hpcHMoLi4uc2hpcHNDb3Jkcyk7XG5cbiAgICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICBjb25zdCByZWNlaXZlZEF0dGFjayA9IGNwdUJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZXMsIGNwdVNoaXBzKTtcblxuICAgICAgaWYgKHJlY2VpdmVkQXR0YWNrKSB7XG4gICAgICAgIC8vIGlmIHJlY2VpdmVkQXR0YWNrIGlzIGEgdHJ1ZSB2YWx1ZSwgaXQgbWVhbnMgdGhhdCBpdCBjb250YWlucyBhIHN1bmtlZCBzaGlwLlxuICAgICAgICBnbG9iYWxMb2dpYy5pbmRpY2F0ZVN1bmsocmVjZWl2ZWRBdHRhY2ssIDIpO1xuICAgICAgICBhdHRhY2tBcm91bmQoXG4gICAgICAgICAgcmVjZWl2ZWRBdHRhY2suY3VycmVudENvb3JkcyxcbiAgICAgICAgICBjcHVCb2FyZC5yZWNlaXZlQXR0YWNrLFxuICAgICAgICAgIGNwdVNoaXBzLFxuICAgICAgICAgIFwiY3B1XCIsXG4gICAgICAgICAgY3B1Qm9hcmQuc3VjY2Vzc0F0dGFja3NcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgdXNlZENvb3JkcyA9IFtdO1xuXG4gICAgY29uc3QgYXR0YWNrUGxheWVyID0gKGNvb3JkcywgaWdub3JlQ29vcmRzKSA9PiB7XG4gICAgICBjb25zdCByYW5kb21JbnQgPSAobWF4KSA9PiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXgpO1xuXG4gICAgICBjb25zdCByYW5kb21Db29yZHMgPSBbcmFuZG9tSW50KDEwKSwgcmFuZG9tSW50KDEwKV07XG5cbiAgICAgIC8vIGNhbGwgdGhlIGZ1bmN0aW9uIGFnYWluIGFuZCBnZW5lcmF0ZSBuZXcgcmFuZG9tIGNvb3JkcyBpZiB0aGUgYXR0YWNrIGhhcyBhbHJlYWR5IGJlIGRvbmUgaW4gdGhhdCBjb29yZGluYXRlLlxuXG4gICAgICBpZiAoXG4gICAgICAgIGdsb2JhbExvZ2ljLmlzVGFyZ2V0SW5BcnJheSh1c2VkQ29vcmRzLCByYW5kb21Db29yZHMpICYmXG4gICAgICAgIGlnbm9yZUNvb3JkcyAhPT0gdHJ1ZVxuICAgICAgKVxuICAgICAgICByZXR1cm4gYXR0YWNrUGxheWVyKCk7XG5cbiAgICAgIGNvbnN0IGF0dGFja0xvZ2ljID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICAgIHJpdmFsUGxheWVyLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZXMpO1xuICAgICAgICB1c2VkQ29vcmRzLnB1c2goY29vcmRpbmF0ZXMpO1xuICAgICAgICBjb25zdCByaXZhbFBsYXllckhpdHMgPSByaXZhbFBsYXllci5wbGF5ZXJCb2FyZC5zdWNjZXNzQXR0YWNrcztcblxuICAgICAgICBpZiAoZ2xvYmFsTG9naWMuaXNUYXJnZXRJbkFycmF5KHJpdmFsUGxheWVySGl0cywgY29vcmRpbmF0ZXMpKSB7XG4gICAgICAgICAgLy8gY2hlY2sgaWYgaXQgd2FzIGEgc3VjY2Vzc2Z1bCBhdHRhY2sgb3Igbm90LlxuICAgICAgICAgIHZpc3VhbEluZGljYXRvcnMoY29vcmRpbmF0ZXMsIHRydWUsIFwicGxheWVyXCIpO1xuICAgICAgICAgIGF0dGFja0Nvcm5lcnMoY29vcmRpbmF0ZXMsIGF0dGFja1BsYXllciwgXCJwbGF5ZXJcIik7XG4gICAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2aXN1YWxJbmRpY2F0b3JzKGNvb3JkaW5hdGVzLCBmYWxzZSwgXCJwbGF5ZXJcIik7XG4gICAgICB9O1xuXG4gICAgICBpZiAoY29vcmRzKSB7XG4gICAgICAgIC8vIHdoZW4gdGhlIGNvb3JkcyBhcmUgaW5kaWNhdGVkIG1hbnVhbGx5LlxuICAgICAgICByZXR1cm4gYXR0YWNrTG9naWMoY29vcmRzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhdHRhY2tMb2dpYyhyYW5kb21Db29yZHMpOyAvLyB3aGVuIHRoZSBjb29yZHMgYXJlIGdlbmVyYXRlZCByYW5kb21seS5cbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGF0dGFja1BsYXllcixcbiAgICAgIGNwdUJvYXJkLFxuICAgICAgY3B1U2hpcHMsXG4gICAgICBjcHVDb29yZHMsXG4gICAgICB1c2VkQ29vcmRzLFxuICAgICAgcmVjZWl2ZUF0dGFjayxcbiAgICB9O1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgUGxheWVyLFxuICAgIGNwdVBsYXllcixcbiAgICB2aXN1YWxJbmRpY2F0b3JzLFxuICAgIGF0dGFja0Nvcm5lcnMsXG4gICAgYXR0YWNrQXJvdW5kLFxuICAgIHJldHVybkNvcm5lcnMsXG4gICAgcmV0dXJuU2lkZXMsXG4gICAgdmFsaWRhdGVDb29yZHMsXG4gIH07XG59KSgpO1xuXG5jb25zdCBHYW1lID0gKCgpID0+IHtcbiAgY29uc3QgbmV3R2FtZSA9IChwbGF5ZXJOYW1lLCBwbGF5ZXJDb29yZHMsIGNwdUNvb3JkcykgPT4ge1xuICAgIGNvbnN0IFBsYXllciA9IHBsYXllckxvZ2ljLlBsYXllcihwbGF5ZXJOYW1lLCBwbGF5ZXJDb29yZHMpO1xuXG4gICAgY29uc3QgY3B1UGxheWVyID0gcGxheWVyTG9naWMuY3B1UGxheWVyKFBsYXllciwgY3B1Q29vcmRzKTtcblxuICAgIHJldHVybiB7IFBsYXllciwgY3B1UGxheWVyIH07XG4gIH07XG5cbiAgcmV0dXJuIHsgbmV3R2FtZSB9O1xufSkoKTtcblxuY29uc3QgRE9NTG9naWMgPSAoKCkgPT4ge1xuICBjb25zdCBkaXNwbGF5R3JpZCA9IChncmlkMSwgZ3JpZDIpID0+IHtcbiAgICBjb25zdCBjcmVhdGVHcmlkID0gKHNpemUpID0+IHtcbiAgICAgIGNvbnN0IHJlY3Vyc2l2ZSA9ICh5UG9zKSA9PiB7XG4gICAgICAgIGlmICh5UG9zID09PSBzaXplKSByZXR1cm47XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICAgICAgICBjb25zdCBncmlkRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgZ3JpZEVsZW1lbnQuY2xhc3NOYW1lID0gYCR7eVBvc30sJHtpfWA7XG5cbiAgICAgICAgICBjb25zdCBncmlkRWxlbWVudDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgIGdyaWRFbGVtZW50Mi5jbGFzc05hbWUgPSBgJHt5UG9zfSwke2l9YDtcblxuICAgICAgICAgIGlmIChncmlkMSkgZ3JpZDEuYXBwZW5kQ2hpbGQoZ3JpZEVsZW1lbnQpO1xuICAgICAgICAgIGlmIChncmlkMikgZ3JpZDIuYXBwZW5kQ2hpbGQoZ3JpZEVsZW1lbnQyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlY3Vyc2l2ZSh5UG9zICsgMSk7XG4gICAgICB9O1xuICAgICAgcmVjdXJzaXZlKDApO1xuICAgIH07XG5cbiAgICBjcmVhdGVHcmlkKDEwKTtcbiAgfTtcblxuICBjb25zdCBmbGF0Q29vcmRzID0gKGNvb3Jkc0FycikgPT4ge1xuICAgIGNvbnN0IG9uZURpbWVuc2lvbkNvb3JkcyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb29yZHNBcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGNvb3JkcyA9IGNvb3Jkc0FycltpXTtcblxuICAgICAgaWYgKHR5cGVvZiBjb29yZHNbMF0gPT09IFwib2JqZWN0XCIpIG9uZURpbWVuc2lvbkNvb3Jkcy5wdXNoKC4uLmNvb3Jkcyk7XG4gICAgICAvLyBpZiB0aGUgc2hpcHMgaGF2ZSBtb3JlIHRoYW4gb25lIGNvb3JkaW5hdGUuXG4gICAgICBlbHNlIG9uZURpbWVuc2lvbkNvb3Jkcy5wdXNoKGNvb3Jkcyk7XG4gICAgfVxuICAgIHJldHVybiBvbmVEaW1lbnNpb25Db29yZHM7XG4gIH07XG5cbiAgY29uc3QgZ2VuSW5kaWNhdG9ycyA9ICh4Q29udGFpbmVyLCB5Q29udGFpbmVyKSA9PiB7XG4gICAgY29uc3QgZ3JpZEluZGljYXRvcnNYID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlY3Rpb25cIik7XG4gICAgY29uc3QgZ3JpZEluZGljYXRvcnNZID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlY3Rpb25cIik7XG5cbiAgICBncmlkSW5kaWNhdG9yc1guY2xhc3NMaXN0LmFkZChcIlhcIik7XG4gICAgZ3JpZEluZGljYXRvcnNZLmNsYXNzTGlzdC5hZGQoXCJZXCIpO1xuXG4gICAgY29uc3QgYWxwaGFiZXQgPSBbXCJBXCIsIFwiQlwiLCBcIkNcIiwgXCJEXCIsIFwiRVwiLCBcIkZcIiwgXCJHXCIsIFwiSFwiLCBcIklcIiwgXCJKXCJdO1xuXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gMTA7IGkrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gaTtcbiAgICAgIGdyaWRJbmRpY2F0b3JzWS5hcHBlbmRDaGlsZChlbGVtZW50KTtcblxuICAgICAgY29uc3QgZWxlbWVudDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgZWxlbWVudDIudGV4dENvbnRlbnQgPSBhbHBoYWJldFtpIC0gMV07XG4gICAgICBncmlkSW5kaWNhdG9yc1guYXBwZW5kQ2hpbGQoZWxlbWVudDIpO1xuICAgIH1cblxuICAgIHhDb250YWluZXIuYXBwZW5kQ2hpbGQoZ3JpZEluZGljYXRvcnNYKTtcbiAgICB5Q29udGFpbmVyLmFwcGVuZENoaWxkKGdyaWRJbmRpY2F0b3JzWSk7XG4gIH07XG5cbiAgY29uc3QgVUlMb2dpYyA9IChub2RlcywgZ2FtZUluZm8pID0+IHtcbiAgICBjb25zdCBwbGF5ZXIxQ29vcmRzID0gZ2FtZUluZm8uUGxheWVyLnBsYXllclNoaXBzLmNvb3JkaW5hdGVzO1xuXG4gICAgY29uc3QgcGxheWVyMkNvb3JkcyA9IGdhbWVJbmZvLmNwdVBsYXllci5jcHVTaGlwcy5jb29yZGluYXRlcztcblxuICAgIGNvbnN0IGF0dGFja1BsYXllciA9IChjb29yZCkgPT4gZ2FtZUluZm8uUGxheWVyLnJlY2VpdmVBdHRhY2soY29vcmQpO1xuXG4gICAgY29uc3QgYXR0YWNrQ3B1ID0gKGNvb3JkKSA9PiBnYW1lSW5mby5jcHVQbGF5ZXIucmVjZWl2ZUF0dGFjayhjb29yZCk7XG5cbiAgICBjb25zdCBhdHRhY2tPbkNsaWNrID0gKHNoaXBDb29yZHMsIG5vZGVDb29yZCwgYXR0YWNrRnVuY3Rpb24pID0+IHtcbiAgICAgIC8vIGlmIHRoZSBwbGF5ZXIgaGFzIGEgc2hpcCBpbiB0aGUgY2xpY2tlZCBjb29yZGluYXRlLCBhdHRhY2sgdGhlIHBsYXllciB0byB0aGF0IHNwZWNpZmljIGNvb3JkLlxuICAgICAgbGV0IHdhc1N1Y2Nlc3NmdWwgPSBmYWxzZTtcbiAgICAgIGlmIChnbG9iYWxMb2dpYy5pc1RhcmdldEluQXJyYXkoT2JqZWN0LnZhbHVlcyhzaGlwQ29vcmRzKSwgbm9kZUNvb3JkKSkge1xuICAgICAgICAvLyB3aGVuIHRoZSBub2RlQ29vcmQgaXMgaW5zaWRlIG9mIGEgb25lLWNvb3JkaW5hdGUgc2hpcCwgdGhpcyBjb25kaXRpb25hbCBpcyB1c2VkLlxuICAgICAgICBhdHRhY2tGdW5jdGlvbihub2RlQ29vcmQpO1xuICAgICAgICB3YXNTdWNjZXNzZnVsID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICAvLyB3aGVuIHRoZSBub2RlQ29vcmQgaXMgaW5zaWRlIG9mIGEgbXVsdGlwbGUtY29vcmRpbmF0ZSBzaGlwLlxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwQ29vcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIC8vIGxvb3AgdGhyb3VnaCB0aGUgY29vcmRzIGFycmF5IG9mIGVhY2ggc2hpcCwgdW50aWwgdGhlIG5vZGVDb29yZCBpcyBmb3VuZC5cbiAgICAgICAgY29uc3QgY3VycmVudENvb3JkcyA9IHNoaXBDb29yZHNbaV07XG4gICAgICAgIGlmIChnbG9iYWxMb2dpYy5pc1RhcmdldEluQXJyYXkoY3VycmVudENvb3Jkcywgbm9kZUNvb3JkKSkge1xuICAgICAgICAgIGF0dGFja0Z1bmN0aW9uKG5vZGVDb29yZCk7XG4gICAgICAgICAgd2FzU3VjY2Vzc2Z1bCA9IHRydWU7XG5cbiAgICAgICAgICBicmVhazsgLy8gc3RvcCBsb29waW5nIHRocm91Z2ggdGhlIHNoaXBzIGNvb3JkcyB0byBvcHRpbWl6ZSB0aW1lIGNvbXBsZXhpdHkuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB3YXNTdWNjZXNzZnVsO1xuICAgIH07XG5cbiAgICAvLyBub3RlLCB0aGUgYXR0YWNrT25DbGljayBmdW5jdGlvbiB3aWxsIGFsd2F5cyBjYWxsIHRoZSBhdHRhY2tGdW5jdGlvbiBvbiBhIHN1Y2Nlc3NmdWwgYXR0YWNrLlxuICAgIC8vIHRoYXQncyB3aHkgd2Ugd2lsbCBuZWVkIHRoZSBuZXh0IGZ1bmN0aW9uLlxuXG4gICAgY29uc3QgbWlzc2VkQXR0YWNrT25DbGljayA9IChub2RlQ29vcmQsIGF0dGFja0Z1bmN0aW9uKSA9PiB7XG4gICAgICBhdHRhY2tGdW5jdGlvbihub2RlQ29vcmQpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICBjb25zdCBkZXRlY3RBdHRhY2tzID0gKGUpID0+IHtcbiAgICAgIGNvbnN0IHBhcmVudENsYXNzID0gZS50YXJnZXQucGFyZW50RWxlbWVudC5jbGFzc05hbWU7XG5cbiAgICAgIGNvbnN0IG5vZGVDbGFzcyA9IGUudGFyZ2V0LmNsYXNzTmFtZTtcblxuICAgICAgY29uc3Qgbm9kZUNvb3JkID0gZ2xvYmFsTG9naWMuY2xhc3NUb0FycmF5KG5vZGVDbGFzcyk7XG5cbiAgICAgIGlmIChwYXJlbnRDbGFzcyA9PT0gXCJncmlkLTFcIikge1xuICAgICAgICAvLyBpZiB0aGUgY2xpY2tlZCBjb29yZGluYXRlIGlzIGluc2lkZSBvZiBncmlkLTEsIHdlIGtub3cgdGhhdCBpdCBpcyBhbiBhdHRhY2sgdG8gcGxheWVyMS5cblxuICAgICAgICBjb25zdCBjbGVhbkNvb3JkcyA9IE9iamVjdC52YWx1ZXMocGxheWVyMUNvb3JkcykuZmlsdGVyKFxuICAgICAgICAgIChjb29yZHMpID0+IGNvb3JkcyAhPT0gdW5kZWZpbmVkXG4gICAgICAgICk7IC8vIGZpbHRlciB1bmRlZmluZWQgY29vcmRzLlxuXG4gICAgICAgIGlmIChhdHRhY2tPbkNsaWNrKGNsZWFuQ29vcmRzLCBub2RlQ29vcmQsIGF0dGFja1BsYXllcikgPT09IHRydWUpIHtcbiAgICAgICAgICBwbGF5ZXJMb2dpYy52aXN1YWxJbmRpY2F0b3JzKG5vZGVDbGFzcywgdHJ1ZSwgXCJwbGF5ZXJcIik7XG4gICAgICAgICAgcGxheWVyTG9naWMuYXR0YWNrQ29ybmVycyhub2RlQ29vcmQsIGF0dGFja1BsYXllciwgXCJwbGF5ZXJcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWlzc2VkQXR0YWNrT25DbGljayhub2RlQ29vcmQsIGF0dGFja1BsYXllcik7XG4gICAgICAgICAgcGxheWVyTG9naWMudmlzdWFsSW5kaWNhdG9ycyhub2RlQ2xhc3MsIGZhbHNlLCBcInBsYXllclwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocGFyZW50Q2xhc3MgPT09IFwiZ3JpZC0yXCIpIHtcbiAgICAgICAgY29uc3QgY2xlYW5Db29yZHMgPSBPYmplY3QudmFsdWVzKHBsYXllcjJDb29yZHMpLmZpbHRlcihcbiAgICAgICAgICAoY29vcmRzKSA9PiBjb29yZHMgIT09IHVuZGVmaW5lZFxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChhdHRhY2tPbkNsaWNrKGNsZWFuQ29vcmRzLCBub2RlQ29vcmQsIGF0dGFja0NwdSkgPT09IHRydWUpIHtcbiAgICAgICAgICBwbGF5ZXJMb2dpYy52aXN1YWxJbmRpY2F0b3JzKG5vZGVDbGFzcywgdHJ1ZSwgXCJjcHVcIik7XG4gICAgICAgICAgcGxheWVyTG9naWMuYXR0YWNrQ29ybmVycyhub2RlQ29vcmQsIGF0dGFja0NwdSwgXCJjcHVcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWlzc2VkQXR0YWNrT25DbGljayhub2RlQ29vcmQsIGF0dGFja0NwdSk7XG4gICAgICAgICAgcGxheWVyTG9naWMudmlzdWFsSW5kaWNhdG9ycyhub2RlQ2xhc3MsIGZhbHNlLCBcImNwdVwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgbm9kZXNbaV0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGRldGVjdEF0dGFja3MsIHsgb25jZTogdHJ1ZSB9KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgc3RhcnRHYW1lID0gKFxuICAgIGdyaWRDb250YWluZXIxLFxuICAgIGdyaWRDb250YWluZXIyLFxuICAgIHBsYXllckNvb3JkcyxcbiAgICBjcHVDb29yZHNcbiAgKSA9PiB7XG4gICAgY29uc3QgY3VycmVudEdhbWUgPSBHYW1lLm5ld0dhbWUoXCJleGFtcGxlXCIsIHBsYXllckNvb3JkcywgY3B1Q29vcmRzKTtcblxuICAgIGlmIChncmlkQ29udGFpbmVyMS5jbGFzc05hbWUgIT09IFwic2hvd24tZ3JpZFwiKSB7XG4gICAgICBVSUxvZ2ljKGdyaWRDb250YWluZXIxLmNoaWxkTm9kZXMsIGN1cnJlbnRHYW1lKTtcbiAgICB9XG5cbiAgICBpZiAoZ3JpZENvbnRhaW5lcjIuY2xhc3NOYW1lICE9PSBcInNob3duLWdyaWRcIikge1xuICAgICAgVUlMb2dpYyhncmlkQ29udGFpbmVyMi5jaGlsZE5vZGVzLCBjdXJyZW50R2FtZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgY3VycmVudEdhbWUsIGdyaWRDb250YWluZXIxLCBncmlkQ29udGFpbmVyMiB9O1xuICB9O1xuXG4gIGNvbnN0IGdlbkRPTUVsZW1lbnRzID0gKCkgPT4ge1xuICAgIGNvbnN0IHNob3dTaGlwcyA9IChjdXJyZW50Q29vcmRzLCBncmlkTnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBjb29yZHMgPSBmbGF0Q29vcmRzKGN1cnJlbnRDb29yZHMpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBnbG9iYWxMb2dpYy5jaGFuZ2VDb29yZENvbG9yKFxuICAgICAgICAgIGdsb2JhbExvZ2ljLmNvb3JkVG9DbGFzcyhjb29yZHNbaV0pLFxuICAgICAgICAgIGdyaWROdW1iZXIsXG4gICAgICAgICAgXCJncmVlblwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGRlbGV0ZUVsZW1lbnRzID0gKGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBncmlkc0NvbnRhaW5lciA9XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJncmlkcy1jb250YWluZXJcIilbaW5kZXhdO1xuICAgICAgaWYgKGdyaWRzQ29udGFpbmVyKSBncmlkc0NvbnRhaW5lci5yZW1vdmUoKTtcbiAgICB9O1xuXG4gICAgY29uc3QgZ2VuR3JpZCA9IChwbGF5ZXJJbmRleCwgY29vcmRzKSA9PiB7XG4gICAgICBjb25zdCBncmlkc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWN0aW9uXCIpO1xuICAgICAgZ3JpZHNDb250YWluZXIuY2xhc3NOYW1lID0gXCJncmlkcy1jb250YWluZXJcIjtcblxuICAgICAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuICAgICAgaWYgKG1haW4pIG1haW4uYXBwZW5kQ2hpbGQoZ3JpZHNDb250YWluZXIpO1xuXG4gICAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgICAgbmFtZS50ZXh0Q29udGVudCA9IGBQbGF5ZXIncyAke3BsYXllckluZGV4fSBHcmlkYDtcbiAgICAgIGdyaWRzQ29udGFpbmVyLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gICAgICBjb25zdCBncmlkV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBncmlkV3JhcHBlci5jbGFzc05hbWUgPSBcImdyaWQtd3JhcHBlclwiO1xuXG4gICAgICBnZW5JbmRpY2F0b3JzKGdyaWRzQ29udGFpbmVyLCBncmlkV3JhcHBlcik7IC8vIGdlbiBpbmRpY2F0b3JzIGhlcmUgdG8gcHV0IFwiWFwiIGNvbnRhaW5lciBhYm92ZSB0aGUgZ3JpZC5cblxuICAgICAgZ3JpZHNDb250YWluZXIuYXBwZW5kQ2hpbGQoZ3JpZFdyYXBwZXIpO1xuXG4gICAgICBjb25zdCBncmlkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGdyaWQuY2xhc3NOYW1lID0gYGdyaWQtJHtwbGF5ZXJJbmRleH1gO1xuICAgICAgZ3JpZFdyYXBwZXIuYXBwZW5kQ2hpbGQoZ3JpZCk7XG5cbiAgICAgIGlmIChwbGF5ZXJJbmRleCA9PT0gMSkgRE9NTG9naWMuZGlzcGxheUdyaWQoZ3JpZCwgbnVsbCk7XG4gICAgICBlbHNlIHtcbiAgICAgICAgRE9NTG9naWMuZGlzcGxheUdyaWQobnVsbCwgZ3JpZCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjb29yZHMpIHtcbiAgICAgICAgZ3JpZC5jbGFzc05hbWUgPSBgc2hvd24tZ3JpZGA7XG4gICAgICAgIHNob3dTaGlwcyhjb29yZHMsIHBsYXllckluZGV4KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGdyaWQ7XG4gICAgfTtcblxuICAgIGNvbnN0IGdlblN0YXJ0QnV0dG9uID0gKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgc3RhcnRCdXR0b24uY2xhc3NOYW1lID0gXCJzdGFydC1idXR0b25cIjtcbiAgICAgIHN0YXJ0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTdGFydCBHYW1lXCI7XG4gICAgICBjb25zdCBncmlkc0NvbnRhaW5lciA9XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJncmlkcy1jb250YWluZXJcIilbMF07XG4gICAgICBpZiAoZ3JpZHNDb250YWluZXIpIGdyaWRzQ29udGFpbmVyLmFwcGVuZENoaWxkKHN0YXJ0QnV0dG9uKTtcbiAgICB9O1xuXG4gICAgY29uc3QgZ2VuUmFuZG9taXplQnV0dG9uID0gKCkgPT4ge1xuICAgICAgY29uc3QgcmFuZG9tQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgIHJhbmRvbUJ1dHRvbi5jbGFzc05hbWUgPSBcInJhbmRvbS1idXR0b25cIjtcbiAgICAgIHJhbmRvbUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiUmFuZG9taXplIENvb3JkaW5hdGVzXCI7XG4gICAgICBjb25zdCBncmlkc0NvbnRhaW5lciA9XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJncmlkcy1jb250YWluZXJcIilbMF07XG4gICAgICBpZiAoZ3JpZHNDb250YWluZXIpIGdyaWRzQ29udGFpbmVyLmFwcGVuZENoaWxkKHJhbmRvbUJ1dHRvbik7XG4gICAgfTtcblxuICAgIHJldHVybiB7IGdlbkdyaWQsIGRlbGV0ZUVsZW1lbnRzLCBnZW5TdGFydEJ1dHRvbiwgZ2VuUmFuZG9taXplQnV0dG9uIH07XG4gIH07XG5cbiAgY29uc3QgY3JlYXRlTW9kYWwgPSAod2lubmVyKSA9PiB7XG5cbiAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIilcblxuICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpYWxvZ1wiKVxuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbFwiKVxuICAgIGJvZHkuYXBwZW5kQ2hpbGQobW9kYWwpXG5cbiAgICBjb25zdCBtb2RhbFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gICAgbW9kYWwuYXBwZW5kQ2hpbGQobW9kYWxUZXh0KVxuXG4gICAgbW9kYWxUZXh0LnRleHRDb250ZW50ID0gYENvbmdyYXR1bGF0aW9ucyAke3dpbm5lcn0sIHlvdSB3b24hYFxuXG4gICAgY29uc3QgcmVsb2FkR2FtZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIilcbiAgICByZWxvYWRHYW1lQnV0dG9uLnRleHRDb250ZW50ID0gXCJOZXcgR2FtZVwiXG5cbiAgICBjb25zdCByZWxvYWRQYWdlID0gKCkgPT4gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpXG5cbiAgICByZWxvYWRHYW1lQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCByZWxvYWRQYWdlKVxuICAgIG1vZGFsLmFwcGVuZENoaWxkKHJlbG9hZEdhbWVCdXR0b24pXG5cbiAgICBtb2RhbC5zaG93TW9kYWwoKVxuXG4gIH1cblxuICBjb25zdCBlbmRHYW1lID0gKHdpbm5lcikgPT4ge1xuXG4gICAgY29uc3QgcGxheWVyMUdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiZ3JpZC0xXCIpWzBdO1xuXG4gICAgY29uc3QgcGxheWVyMkdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiZ3JpZC0yXCIpWzBdO1xuXG4gICAgLy8gY2xvbmVkIGVsZW1lbnRzIGRvIG5vdCBjYXJyeSBldmVudCBsaXN0ZW5lcnMuXG5cbiAgICBpZiAocGxheWVyMUdyaWQpXG4gICAgICBwbGF5ZXIxR3JpZC5yZXBsYWNlV2l0aChwbGF5ZXIxR3JpZC5jbG9uZU5vZGUodHJ1ZSkpO1xuXG5cbiAgICBpZiAocGxheWVyMkdyaWQpXG4gICAgICBwbGF5ZXIyR3JpZC5yZXBsYWNlV2l0aChwbGF5ZXIyR3JpZC5jbG9uZU5vZGUodHJ1ZSkpO1xuXG4gICAgY3JlYXRlTW9kYWwod2lubmVyKVxuXG4gIH07XG5cbiAgcmV0dXJuIHsgc3RhcnRHYW1lLCBkaXNwbGF5R3JpZCwgZ2VuRE9NRWxlbWVudHMsIGVuZEdhbWUgfTtcbn0pKCk7XG5cbmNvbnN0IEdhbWVMb29wID0gKCgpID0+IHtcbiAgY29uc3QgZ2FtZVR1cm5zID0gKHBsYXllcjEsIHBsYXllcjIpID0+IHtcbiAgICBjb25zdCBwbGF5ZXIxU2hpcHMgPSBwbGF5ZXIxLnBsYXllclNoaXBzO1xuXG4gICAgY29uc3QgcGxheWVyMlNoaXBzID0gcGxheWVyMi5jcHVTaGlwcztcblxuICAgIGNvbnN0IHR1cm5zTG9naWMgPSAoKSA9PiB7XG4gICAgICBsZXQgaXNHYW1lT3ZlciA9IGZhbHNlO1xuICAgICAgcGxheWVyMi5hdHRhY2tQbGF5ZXIoKTtcblxuICAgICAgaWYgKHBsYXllcjEucGxheWVyQm9hcmQuY2hlY2tTdW5rKHBsYXllcjFTaGlwcykpIHtcbiAgICAgICAgRE9NTG9naWMuZW5kR2FtZShcIlBsYXllcjFcIik7XG4gICAgICAgIGlzR2FtZU92ZXIgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAocGxheWVyMi5jcHVCb2FyZC5jaGVja1N1bmsocGxheWVyMlNoaXBzKSkge1xuICAgICAgICBET01Mb2dpYy5lbmRHYW1lKFwiUGxheWVyMlwiKTtcbiAgICAgICAgaXNHYW1lT3ZlciA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpc0dhbWVPdmVyO1xuICAgIH07XG4gICAgcmV0dXJuIHsgdHVybnNMb2dpYyB9O1xuICB9O1xuXG4gIGNvbnN0IGdlbkNvb3JkcyA9ICgpID0+IHtcbiAgICBjb25zdCBzdXJyb3VuZENvb3JkcyA9IChub2RlQ29vcmQpID0+IHtcbiAgICAgIGNvbnN0IGdldFN1cnJ1b25kcyA9IChub2RlKSA9PiB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRTdXJyb3VuZHMgPSBbXG4gICAgICAgICAgLi4ucGxheWVyTG9naWMucmV0dXJuQ29ybmVycyhub2RlKSxcbiAgICAgICAgICAuLi5wbGF5ZXJMb2dpYy5yZXR1cm5TaWRlcyhub2RlKSxcbiAgICAgICAgICBub2RlLFxuICAgICAgICBdO1xuXG4gICAgICAgIHJldHVybiBwbGF5ZXJMb2dpYy52YWxpZGF0ZUNvb3JkcyhjdXJyZW50U3Vycm91bmRzKTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNvb3JkcyA9IFtdO1xuICAgICAgaWYgKHR5cGVvZiBub2RlQ29vcmRbMF0gIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgLy8gb25lLWNvb3JkIHNoaXBcbiAgICAgICAgY29uc3Qgc3Vycm91bmQgPSBnZXRTdXJydW9uZHMobm9kZUNvb3JkKTtcbiAgICAgICAgY29vcmRzLnB1c2goLi4uc3Vycm91bmQpO1xuXG4gICAgICAgIHJldHVybiBjb29yZHM7XG4gICAgICB9XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZUNvb3JkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb29yZCA9IG5vZGVDb29yZFtpXTtcbiAgICAgICAgY29uc3Qgc3Vycm91bmQgPSBnZXRTdXJydW9uZHMoY3VycmVudENvb3JkKTtcblxuICAgICAgICBjb29yZHMucHVzaCguLi5zdXJyb3VuZCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5vUmVwZWF0Q29vcmRzID0gWy4uLm5ldyBTZXQoY29vcmRzKV07XG5cbiAgICAgIHJldHVybiBub1JlcGVhdENvb3JkcztcbiAgICB9O1xuXG4gICAgY29uc3QgcmFuZG9tSW50ID0gKG1heCkgPT4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4KTtcblxuICAgIGNvbnN0IHJhbmRvbU9yaWVudGF0aW9uID0gKCkgPT4ge1xuICAgICAgY29uc3QgbnVtYmVyID0gcmFuZG9tSW50KDIpO1xuXG4gICAgICBpZiAobnVtYmVyID09PSAwKSByZXR1cm4gXCJoXCI7XG4gICAgICByZXR1cm4gXCJ2XCI7XG4gICAgfTtcblxuICAgIGNvbnN0IGdlblJhbmRvbUNvb3JkcyA9IChvcmllbnRhdGlvbiwgc2l6ZSwgcHJldmlvdXNDb29yZHMpID0+IHtcbiAgICAgIGlmIChwcmV2aW91c0Nvb3Jkcykge1xuICAgICAgICBjb25zdCB2ZXJ0aWNhbENvb3JkcyA9IFtwcmV2aW91c0Nvb3Jkc1swXSArIDEsIHByZXZpb3VzQ29vcmRzWzFdXTtcbiAgICAgICAgY29uc3QgaG9yaXpvbnRhbENvb3JkcyA9IFtwcmV2aW91c0Nvb3Jkc1swXSwgcHJldmlvdXNDb29yZHNbMV0gKyAxXTtcblxuICAgICAgICBpZiAob3JpZW50YXRpb24gPT09IFwidlwiKSByZXR1cm4gdmVydGljYWxDb29yZHM7XG5cbiAgICAgICAgcmV0dXJuIGhvcml6b250YWxDb29yZHM7XG4gICAgICB9XG5cbiAgICAgIGxldCByYW5kb21Db29yZHM7XG5cbiAgICAgIC8vIHN1YnN0cmFjdCB0aGUgc2l6ZSBkZXBlbmRpbmcgb24gdGhlIG9yaWVudGF0aW9uLCBpbiBvcmRlciB0byBoYXZlIHNwYWNlIGZvciB0aGUgbmV4dCBjb29yZHMgb2YgdGhlIHNoaXAuXG4gICAgICBpZiAob3JpZW50YXRpb24gPT09IFwidlwiKVxuICAgICAgICByYW5kb21Db29yZHMgPSBbcmFuZG9tSW50KDEwIC0gc2l6ZSksIHJhbmRvbUludCgxMCldO1xuICAgICAgZWxzZSB7XG4gICAgICAgIHJhbmRvbUNvb3JkcyA9IFtyYW5kb21JbnQoMTApLCByYW5kb21JbnQoMTAgLSBzaXplKV07XG4gICAgICB9XG5cbiAgICAgIGlmIChzaXplID09PSAxKSByYW5kb21Db29yZHMgPSBbcmFuZG9tSW50KDEwKSwgcmFuZG9tSW50KDEwKV07XG5cbiAgICAgIHJldHVybiByYW5kb21Db29yZHM7XG4gICAgfTtcblxuICAgIGNvbnN0IGdlblNoaXBDb29yZCA9IChzaXplLCB1c2VkQ29vcmRzKSA9PiB7XG4gICAgICAvLyB0aGUgcHJvYmxlbSBpcyBiZWNhdXNlIHRoZSB3cm9uZyBzaGlwcyBhcmUgc3RpbGwgb2N1cHBpbmcgc3BhY2UgaW4gdXNlZENvb3Jkcywgc28gd2UgaGF2ZSB0byBtYWtlIGEgcGxhbiBvbiBob3cgdG8gZnJlZSB1cCB0aGVzZSBzcGFjZXMuXG4gICAgICAvLyBjcmVhdGUgYSBiZWZvcmVTaGlwIHVzZWRjb29yZHM/XG4gICAgICBjb25zdCBzaGlwQ29vcmRzID0gW107XG5cbiAgICAgIGNvbnN0IG9yaWVudGF0aW9uID0gcmFuZG9tT3JpZW50YXRpb24oKTtcblxuICAgICAgY29uc3QgZ2VuSW5pdGlhbENvb3JkcyA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgY29vcmRzID0gZ2VuUmFuZG9tQ29vcmRzKG9yaWVudGF0aW9uLCBzaXplKTtcblxuICAgICAgICBpZiAoIWdsb2JhbExvZ2ljLmlzVGFyZ2V0SW5BcnJheSh1c2VkQ29vcmRzLCBjb29yZHMpKSB7XG4gICAgICAgICAgLy8gdmFsaWRhdGUgdGhhdCB0aGUgaW5pdGlhbCBjb29yZCBpcyBpbiBhIHZhbGlkIHBvc2l0aW9uXG4gICAgICAgICAgc2hpcENvb3Jkcy5wdXNoKGNvb3Jkcyk7XG4gICAgICAgIH0gZWxzZSBnZW5Jbml0aWFsQ29vcmRzKCk7IC8vIGlmIHRoZSBnZW5lcmF0ZWQgY29vcmRzIGFyZSBhbHJlYWR5IHVzZWQsIGdlbmVyYXRlIG5ldyBjb29yZHMuXG4gICAgICB9O1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykge1xuICAgICAgICBjb25zdCBwcmV2aW91c0Nvb3JkcyA9IHNoaXBDb29yZHNbc2hpcENvb3Jkcy5sZW5ndGggLSAxXTtcbiAgICAgICAgY29uc3QgY29vcmRzID0gZ2VuUmFuZG9tQ29vcmRzKG9yaWVudGF0aW9uLCBzaXplLCBwcmV2aW91c0Nvb3Jkcyk7XG5cbiAgICAgICAgaWYgKHByZXZpb3VzQ29vcmRzKSB7XG4gICAgICAgICAgc2hpcENvb3Jkcy5wdXNoKGNvb3Jkcyk7XG4gICAgICAgIH0gZWxzZSBnZW5Jbml0aWFsQ29vcmRzKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIG11bHRpcGxlIGNvb3JkaW5hdGUgc2hpcFxuICAgICAgaWYgKHNoaXBDb29yZHMubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgc2hpcENvb3Jkcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICBjb25zdCBlbGVtZW50ID0gc2hpcENvb3Jkc1tpbmRleF07XG4gICAgICAgICAgaWYgKGdsb2JhbExvZ2ljLmlzVGFyZ2V0SW5BcnJheSh1c2VkQ29vcmRzLCBlbGVtZW50KSkgaXNWYWxpZCA9IGZhbHNlOyAvLyBpZiBvbmUgZWxlbWVudCBvZiB0aGUgc2hpcCBoYXMgYSBpbnZhbGlkIHBvc2l0aW9uLCBpc1ZhbGlkIGlzIGZhbHNlLlxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzVmFsaWQgPT09IGZhbHNlKSByZXR1cm4gZ2VuU2hpcENvb3JkKHNpemUsIHVzZWRDb29yZHMpOyAvLyBhbmQgd2hlbiBpc1ZhbGlkIGlzIGZhbHNlLCB3ZSByZWN1cnNpdmVseSBjaGFuZ2UgdGhlIHNoaXAgcG9zaXRpb24sIHVudGlsIGl0IGlzIHZhbGlkLlxuXG4gICAgICAgIHJldHVybiBzaGlwQ29vcmRzO1xuICAgICAgfVxuXG4gICAgICAvLyBvbmUgY29vcmRpbmF0ZSBzaGlwLlxuICAgICAgcmV0dXJuIHNoaXBDb29yZHNbMF07XG4gICAgfTtcblxuICAgIGNvbnN0IGdlbkJhdHRsZXNoaXBzID0gKCkgPT4ge1xuICAgICAgY29uc3QgdXNlZENvb3JkcyA9IFtdO1xuXG4gICAgICBjb25zdCBjYXJyaWVyID0gZ2VuU2hpcENvb3JkKDQsIHVzZWRDb29yZHMpO1xuICAgICAgdXNlZENvb3Jkcy5wdXNoKC4uLnN1cnJvdW5kQ29vcmRzKGNhcnJpZXIpKTtcblxuICAgICAgY29uc3QgYmF0dGxlU2hpcCA9IGdlblNoaXBDb29yZCgzLCB1c2VkQ29vcmRzKTtcbiAgICAgIHVzZWRDb29yZHMucHVzaCguLi5zdXJyb3VuZENvb3JkcyhiYXR0bGVTaGlwKSk7XG5cbiAgICAgIGNvbnN0IGJhdHRsZVNoaXAxID0gZ2VuU2hpcENvb3JkKDMsIHVzZWRDb29yZHMpO1xuICAgICAgdXNlZENvb3Jkcy5wdXNoKC4uLnN1cnJvdW5kQ29vcmRzKGJhdHRsZVNoaXAxKSk7XG5cbiAgICAgIGNvbnN0IGNydWlzZXIgPSBnZW5TaGlwQ29vcmQoMiwgdXNlZENvb3Jkcyk7XG4gICAgICB1c2VkQ29vcmRzLnB1c2goLi4uc3Vycm91bmRDb29yZHMoY3J1aXNlcikpO1xuXG4gICAgICBjb25zdCBjcnVpc2VyMSA9IGdlblNoaXBDb29yZCgyLCB1c2VkQ29vcmRzKTtcbiAgICAgIHVzZWRDb29yZHMucHVzaCguLi5zdXJyb3VuZENvb3JkcyhjcnVpc2VyMSkpO1xuXG4gICAgICBjb25zdCBjcnVpc2VyMiA9IGdlblNoaXBDb29yZCgyLCB1c2VkQ29vcmRzKTtcbiAgICAgIHVzZWRDb29yZHMucHVzaCguLi5zdXJyb3VuZENvb3JkcyhjcnVpc2VyMikpO1xuXG4gICAgICBjb25zdCBkZXN0cm95ZXIgPSBnZW5TaGlwQ29vcmQoMSwgdXNlZENvb3Jkcyk7XG4gICAgICB1c2VkQ29vcmRzLnB1c2goLi4uc3Vycm91bmRDb29yZHMoZGVzdHJveWVyKSk7XG5cbiAgICAgIGNvbnN0IGRlc3Ryb3llcjEgPSBnZW5TaGlwQ29vcmQoMSwgdXNlZENvb3Jkcyk7XG4gICAgICB1c2VkQ29vcmRzLnB1c2goLi4uc3Vycm91bmRDb29yZHMoZGVzdHJveWVyMSkpO1xuXG4gICAgICBjb25zdCBkZXN0cm95ZXIyID0gZ2VuU2hpcENvb3JkKDEsIHVzZWRDb29yZHMpO1xuICAgICAgdXNlZENvb3Jkcy5wdXNoKC4uLnN1cnJvdW5kQ29vcmRzKGRlc3Ryb3llcjIpKTtcblxuICAgICAgY29uc3QgZGVzdHJveWVyMyA9IGdlblNoaXBDb29yZCgxLCB1c2VkQ29vcmRzKTtcbiAgICAgIHVzZWRDb29yZHMucHVzaCguLi5zdXJyb3VuZENvb3JkcyhkZXN0cm95ZXIzKSk7XG5cbiAgICAgIGNvbnN0IGNvb3JkcyA9IFtcbiAgICAgICAgY2FycmllcixcbiAgICAgICAgYmF0dGxlU2hpcCxcbiAgICAgICAgYmF0dGxlU2hpcDEsXG4gICAgICAgIGNydWlzZXIsXG4gICAgICAgIGNydWlzZXIxLFxuICAgICAgICBjcnVpc2VyMixcbiAgICAgICAgZGVzdHJveWVyLFxuICAgICAgICBkZXN0cm95ZXIxLFxuICAgICAgICBkZXN0cm95ZXIyLFxuICAgICAgICBkZXN0cm95ZXIzLFxuICAgICAgXTtcblxuICAgICAgcmV0dXJuIHsgY29vcmRzLCB1c2VkQ29vcmRzIH07XG4gICAgfTtcblxuICAgIHJldHVybiB7IGdlbkJhdHRsZXNoaXBzLCBnZW5TaGlwQ29vcmQsIHN1cnJvdW5kQ29vcmRzIH07XG4gIH07XG5cbiAgY29uc3QgZ2VuRE9NID0gRE9NTG9naWMuZ2VuRE9NRWxlbWVudHMoKTtcblxuICBjb25zdCBzaW5nbGVQbGF5ZXIgPSAoY29vcmRzLCBzYW1lQ29vcmRzKSA9PiB7XG4gICAgZ2VuRE9NLmRlbGV0ZUVsZW1lbnRzKDApOyAvLyBjbGVhciBwcmV2aW91cyBlbGVtZW50c1xuXG4gICAgbGV0IG5ld0dhbWU7XG5cbiAgICBpZiAoc2FtZUNvb3JkcyAhPT0gdHJ1ZSkge1xuICAgICAgY29uc3QgY3B1Q29vcmRzID0gZ2VuQ29vcmRzKCkuZ2VuQmF0dGxlc2hpcHMoKS5jb29yZHM7IC8vIGdlbiByYW5kb20gY29vcmRzLlxuICAgICAgbmV3R2FtZSA9IERPTUxvZ2ljLnN0YXJ0R2FtZShcbiAgICAgICAgZ2VuRE9NLmdlbkdyaWQoMSwgY29vcmRzKSxcbiAgICAgICAgZ2VuRE9NLmdlbkdyaWQoMiksXG4gICAgICAgIGNvb3JkcyxcbiAgICAgICAgY3B1Q29vcmRzXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdHYW1lID0gRE9NTG9naWMuc3RhcnRHYW1lKFxuICAgICAgICBnZW5ET00uZ2VuR3JpZCgxLCBjb29yZHMpLFxuICAgICAgICBnZW5ET00uZ2VuR3JpZCgyKSxcbiAgICAgICAgY29vcmRzLFxuICAgICAgICBjb29yZHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgcGxheWVyT2JqID0gbmV3R2FtZS5jdXJyZW50R2FtZS5QbGF5ZXI7XG4gICAgY29uc3QgY3B1T2JqID0gbmV3R2FtZS5jdXJyZW50R2FtZS5jcHVQbGF5ZXI7XG4gICAgY29uc3QgY3VycmVudFR1cm4gPSBnYW1lVHVybnMocGxheWVyT2JqLCBjcHVPYmosIDApO1xuICAgIGNvbnN0IGNwdUdyaWQgPSBuZXdHYW1lLmdyaWRDb250YWluZXIyO1xuXG4gICAgLy8gcmVjZWl2ZSBjb29yZHMsIGdyaWQgY29udGFpbmVycyBhbmQgc3RhcnQgdGhlIGdhbWUuXG5cbiAgICBjb25zdCB0dXJuTG9vcCA9IChnYW1lVHVybiwgdG9BdHRhY2tHcmlkKSA9PiB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRvQXR0YWNrR3JpZC5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSB0b0F0dGFja0dyaWQuY2hpbGROb2Rlc1tpXTtcbiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAgIFwiY2xpY2tcIixcbiAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICBnYW1lVHVybi50dXJuc0xvZ2ljKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IG9uY2U6IHRydWUgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH07XG4gICAgdHVybkxvb3AoY3VycmVudFR1cm4sIGNwdUdyaWQpO1xuXG4gICAgcmV0dXJuIHsgcGxheWVyT2JqLCBjcHVPYmosIGN1cnJlbnRUdXJuIH07XG4gIH07XG5cbiAgLypcbiAgXG4gIGNvbnN0IGZsYXRDb29yZHMgPSAoZWxlbWVudHMpID0+IHtcbiAgICBjb25zdCBtdWx0aXBsZUNvb3JkU2hpcHMgPSBlbGVtZW50cy5maWx0ZXIoXG4gICAgICAoZWwpID0+IHR5cGVvZiBlbFswXSA9PT0gXCJvYmplY3RcIlxuICAgICk7XG4gICAgY29uc3Qgb25lQ29vcmRTaGlwcyA9IGVsZW1lbnRzLmZpbHRlcigoZWwpID0+IHR5cGVvZiBlbFswXSA9PT0gXCJudW1iZXJcIik7XG5cbiAgICBjb25zdCBmbGF0dGVkQ29vcmRzID0gbXVsdGlwbGVDb29yZFNoaXBzLmZsYXQoKS5jb25jYXQob25lQ29vcmRTaGlwcyk7XG5cbiAgICByZXR1cm4gZmxhdHRlZENvb3JkcztcbiAgfTtcblxuICBcbiAgY29uc3QgZHJhZ0FuZERyb3AgPSAoZWxlbWVudHMpID0+IHtcbiAgICBjb25zdCBjb29yZExpc3QgPSBmbGF0Q29vcmRzKGVsZW1lbnRzKTtcblxuICAgIGNvbnN0IGRyYWdTdGFydCA9IChlKSA9PiB7fTtcblxuICAgIGNvbnN0IGRyYWdEcm9wID0gKGUpID0+IHt9O1xuXG4gICAgLy8gYWRkIGV2ZW50IGxpc3RlbmVycyB0byBlYWNoIGVsZW1lbnQuXG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb3JkTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZWxlbWVudE5hbWUgPSBnbG9iYWxMb2dpYy5jb29yZFRvQ2xhc3MoY29vcmRMaXN0W2ldKTtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGVsZW1lbnROYW1lKVswXTtcblxuICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5kcmFnZ2FibGUgPSB0cnVlO1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnc3RhcnRcIiwgZHJhZ1N0YXJ0KTtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCBkcmFnRHJvcCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICAqL1xuXG4gIGNvbnN0IGdlbkluaXRpYWxFbGVtZW50cyA9IChjb29yZHMsIHNhbWVDb29yZHMpID0+IHtcbiAgICBnZW5ET00uZ2VuR3JpZCgxLCBjb29yZHMpO1xuICAgIGdlbkRPTS5nZW5TdGFydEJ1dHRvbigpO1xuICAgIGdlbkRPTS5nZW5SYW5kb21pemVCdXR0b24oKTtcbiAgICAvLyBkcmFnQW5kRHJvcChjb29yZHMpO1xuXG4gICAgY29uc3QgcmFuZG9taXplR3JpZCA9IChpbmRleCkgPT4ge1xuICAgICAgZ2VuRE9NLmRlbGV0ZUVsZW1lbnRzKGluZGV4KTtcbiAgICAgIGdlbkluaXRpYWxFbGVtZW50cyhnZW5Db29yZHMoKS5nZW5CYXR0bGVzaGlwcygpLmNvb3Jkcyk7XG4gICAgfTtcblxuICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInN0YXJ0LWJ1dHRvblwiKVswXTtcbiAgICBjb25zdCByYW5kb21pemVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwicmFuZG9tLWJ1dHRvblwiKVswXTtcblxuICAgIGlmIChyYW5kb21pemVCdXR0b24pXG4gICAgICByYW5kb21pemVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgcmFuZG9taXplR3JpZCgwKTtcbiAgICAgIH0pO1xuXG4gICAgaWYgKHN0YXJ0QnV0dG9uKVxuICAgICAgc3RhcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgc2luZ2xlUGxheWVyKGNvb3Jkcywgc2FtZUNvb3Jkcyk7XG4gICAgICB9KTtcbiAgfTtcblxuICBjb25zdCBzZXR1cERPTSA9ICgpID0+IHtcbiAgICBjb25zdCByYW5kb21Db29yZHMgPSBnZW5Db29yZHMoKS5nZW5CYXR0bGVzaGlwcygpLmNvb3JkcztcbiAgICBnZW5Jbml0aWFsRWxlbWVudHMocmFuZG9tQ29vcmRzLCB0cnVlKTtcbiAgfTtcblxuICByZXR1cm4geyBzaW5nbGVQbGF5ZXIsIHNldHVwRE9NLCBnZW5Db29yZHMsIGdlbkluaXRpYWxFbGVtZW50cyB9O1xufSkoKTtcblxuR2FtZUxvb3Auc2V0dXBET00oKTtcblxuZXhwb3J0IHsgbWFpbk9iamVjdHMsIHBsYXllckxvZ2ljLCBHYW1lLCBET01Mb2dpYywgR2FtZUxvb3AsIGdsb2JhbExvZ2ljIH07XG4iXSwibmFtZXMiOlsiZ2xvYmFsTG9naWMiLCJjb29yZFRvQ2xhc3MiLCJhcnIiLCJzbGljZSIsImNoYW5nZUNvb3JkQ29sb3IiLCJjbGFzc05hbWUiLCJncmlkTnVtYmVyIiwiY29sb3IiLCJjdXJyZW50Q29vcmQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJzdHlsZSIsImJvcmRlciIsImlzVGFyZ2V0SW5BcnJheSIsInRhcmdldCIsImNvbnRhaW5zIiwiSlNPTiIsInN0cmluZ2lmeSIsImkiLCJsZW5ndGgiLCJlbGVtZW50IiwiaW5kaWNhdGVTdW5rIiwic2hpcCIsImN1cnJlbnRDb29yZHMiLCJjbGFzc1RvQXJyYXkiLCJjbGFzc0Nvb3JkIiwiYXJyYXlDb29yZCIsIngiLCJ5IiwicHVzaCIsIk51bWJlciIsIm1haW5PYmplY3RzIiwiU2hpcCIsImxlbmd0aE51bWJlciIsImhpdHNOdW1iZXIiLCJjb29yZHMiLCJzaGlwSGl0cyIsInNoaXBMZW5ndGgiLCJpc1N1bmsiLCJoaXQiLCJjdXJyZW50SGl0cyIsIkdhbWVib2FyZCIsInJlY2VpdmVkQXR0YWNrcyIsInN1Y2Nlc3NBdHRhY2tzIiwicmVjZWl2ZUF0dGFjayIsInRhcmdldENvcmRzIiwicGxheWVyU2hpcHMiLCJjdXJyZW50U2hpcHMiLCJPYmplY3QiLCJlbnRyaWVzIiwiY29vcmRpbmF0ZXMiLCJzdWNjZXNzIiwic2hpcENvcmRzIiwic2hpcE5hbWUiLCJjYXJyaWVyIiwiYmF0dGxlU2hpcCIsImJhdHRsZVNoaXAxIiwiY3J1aXNlciIsImNydWlzZXIxIiwiY3J1aXNlcjIiLCJkZXN0cm95ZXIiLCJkZXN0cm95ZXIxIiwiZGVzdHJveWVyMiIsImRlc3Ryb3llcjMiLCJkZXBsb3lTaGlwcyIsImNhcnJpZXJDb3JkcyIsImJhdHRsZVNoaXBDb3JkcyIsImJhdHRsZVNoaXAxQ29yZHMiLCJjcnVpc2VyQ29yZHMiLCJjcnVpc2VyMUNvcmRzIiwiY3J1aXNlcjJDb3JkcyIsImRlc3Ryb3llckNvcmRzIiwiZGVzdHJveWVyMUNvcmRzIiwiZGVzdHJveWVyMkNvcmRzIiwiZGVzdHJveWVyM0NvcmRzIiwiY2hlY2tTdW5rIiwic2hpcHMiLCJwbGF5ZXJMb2dpYyIsInZpc3VhbEluZGljYXRvcnMiLCJjb29yZCIsIndhc1N1Y2Nlc3NmdWwiLCJpbmRleCIsImN1cnJlbnROb2RlIiwidGV4dENvbnRlbnQiLCJyZW1vdmVOb2RlTGlzdGVuZXJzIiwiY29vcmRpbmF0ZSIsInJlcGxhY2VXaXRoIiwiY2xvbmVOb2RlIiwidmFsaWRhdGVDb29yZHMiLCJ2YWxpZGF0ZWRDb29yZHMiLCJyZXR1cm5TaWRlcyIsIm5vZGVDb29yZCIsInVwIiwiZG93biIsInJpZ2h0IiwibGVmdCIsImF0dGFja0Fyb3VuZCIsIm5vZGVDb29yZHMiLCJhdHRhY2tGdW5jdGlvbiIsImFyb3VuZENvb3JkcyIsImZsYXRDb29yZHMiLCJmbGF0IiwicmV0dXJuQ29ybmVycyIsIm5vZGUiLCJjb3JuZXJzIiwiY29ybmVyMSIsImNvcm5lcjIiLCJjb3JuZXIzIiwiY29ybmVyNCIsImF0dGFja0Nvcm5lcnMiLCJ2YWxpZENvcm5lcnMiLCJQbGF5ZXIiLCJuYW1lIiwic2hpcHNDb29yZHMiLCJwbGF5ZXJOYW1lIiwicGxheWVyQ29vcmRzIiwicGxheWVyQm9hcmQiLCJyZWNlaXZlZEF0dGFjayIsImNwdVBsYXllciIsImh1bWFuUGxheWVyIiwic2hpcHNDb3JkcyIsInJpdmFsUGxheWVyIiwiY3B1Q29vcmRzIiwiY3B1Qm9hcmQiLCJjcHVTaGlwcyIsInVzZWRDb29yZHMiLCJhdHRhY2tQbGF5ZXIiLCJpZ25vcmVDb29yZHMiLCJyYW5kb21JbnQiLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJyYW5kb21Db29yZHMiLCJyaXZhbFBsYXllckhpdHMiLCJhdHRhY2tMb2dpYyIsIkdhbWUiLCJET01Mb2dpYyIsIlVJTG9naWMiLCJub2RlcyIsImdhbWVJbmZvIiwicGxheWVyMUNvb3JkcyIsInBsYXllcjJDb29yZHMiLCJhdHRhY2tDcHUiLCJhdHRhY2tPbkNsaWNrIiwic2hpcENvb3JkcyIsInZhbHVlcyIsIm1pc3NlZEF0dGFja09uQ2xpY2siLCJkZXRlY3RBdHRhY2tzIiwiZSIsInBhcmVudENsYXNzIiwicGFyZW50RWxlbWVudCIsIm5vZGVDbGFzcyIsImNsZWFuQ29vcmRzIiwiZmlsdGVyIiwidW5kZWZpbmVkIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uY2UiLCJzdGFydEdhbWUiLCJncmlkQ29udGFpbmVyMSIsImdyaWRDb250YWluZXIyIiwiY3VycmVudEdhbWUiLCJjaGlsZE5vZGVzIiwiZGlzcGxheUdyaWQiLCJncmlkMSIsImdyaWQyIiwic2l6ZSIsInJlY3Vyc2l2ZSIsInlQb3MiLCJncmlkRWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJncmlkRWxlbWVudDIiLCJhcHBlbmRDaGlsZCIsImNyZWF0ZUdyaWQiLCJnZW5ET01FbGVtZW50cyIsImdlbkdyaWQiLCJwbGF5ZXJJbmRleCIsImdyaWRzQ29udGFpbmVyIiwibWFpbiIsInF1ZXJ5U2VsZWN0b3IiLCJncmlkV3JhcHBlciIsInhDb250YWluZXIiLCJ5Q29udGFpbmVyIiwiZ3JpZEluZGljYXRvcnNYIiwiZ3JpZEluZGljYXRvcnNZIiwiY2xhc3NMaXN0IiwiYWRkIiwiYWxwaGFiZXQiLCJlbGVtZW50MiIsImdlbkluZGljYXRvcnMiLCJncmlkIiwiY29vcmRzQXJyIiwib25lRGltZW5zaW9uQ29vcmRzIiwic2hvd1NoaXBzIiwiZGVsZXRlRWxlbWVudHMiLCJyZW1vdmUiLCJnZW5TdGFydEJ1dHRvbiIsInN0YXJ0QnV0dG9uIiwiZ2VuUmFuZG9taXplQnV0dG9uIiwicmFuZG9tQnV0dG9uIiwiZW5kR2FtZSIsIndpbm5lciIsInBsYXllcjFHcmlkIiwicGxheWVyMkdyaWQiLCJib2R5IiwibW9kYWwiLCJtb2RhbFRleHQiLCJyZWxvYWRHYW1lQnV0dG9uIiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiLCJzaG93TW9kYWwiLCJjcmVhdGVNb2RhbCIsImdlbkNvb3JkcyIsInN1cnJvdW5kQ29vcmRzIiwiZ2V0U3VycnVvbmRzIiwiY3VycmVudFN1cnJvdW5kcyIsInN1cnJvdW5kIiwiU2V0IiwiZ2VuUmFuZG9tQ29vcmRzIiwib3JpZW50YXRpb24iLCJwcmV2aW91c0Nvb3JkcyIsInZlcnRpY2FsQ29vcmRzIiwiaG9yaXpvbnRhbENvb3JkcyIsImdlblNoaXBDb29yZCIsImdlbkluaXRpYWxDb29yZHMiLCJpc1ZhbGlkIiwiZ2VuQmF0dGxlc2hpcHMiLCJnZW5ET00iLCJzaW5nbGVQbGF5ZXIiLCJzYW1lQ29vcmRzIiwibmV3R2FtZSIsInBsYXllck9iaiIsImNwdU9iaiIsImN1cnJlbnRUdXJuIiwicGxheWVyMSIsInBsYXllcjIiLCJwbGF5ZXIxU2hpcHMiLCJwbGF5ZXIyU2hpcHMiLCJ0dXJuc0xvZ2ljIiwiaXNHYW1lT3ZlciIsImdhbWVUdXJucyIsImdhbWVUdXJuIiwidG9BdHRhY2tHcmlkIiwidHVybkxvb3AiLCJnZW5Jbml0aWFsRWxlbWVudHMiLCJyYW5kb21pemVCdXR0b24iLCJzZXR1cERPTSJdLCJzb3VyY2VSb290IjoiIn0=