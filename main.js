(()=>{"use strict";const e=(e,r)=>{let t=!1;if(JSON.stringify(e)===JSON.stringify(r)&&(t=!0),!e)return t;if(!r)return t;for(let s=0;s<e.length;s++){const n=e[s];JSON.stringify(n)===JSON.stringify(r)&&(t=!0)}return t},r=(e,r,t)=>{let s=0;"cpu"===t&&(s=1);const n=document.getElementsByClassName(e)[s];n&&(n.textContent=!1===r?"â€¢":"X")},t=(()=>{const r=(e,r,t)=>{let s=r;const n=e;return{isSunk:()=>n===s,hit:()=>s++,currentHits:()=>s,currentCords:t,shipLength:n}};return{Ship:r,Gameboard:()=>{const t=[],s=[];return{receiveAttack:(r,n)=>{const c=Object.entries(n.coordinates);t.push(r);for(let t=0;t<c.length;t++){let i=!1;const a=c[t][1],o=c[t][0];if(e(a,r)&&(i=!0,s.push(r),"carrier"===o&&n.carrier.hit(),"battleShip"===o&&n.battleShip.hit(),"battleShip1"===o&&n.battleShip1.hit(),"cruiser"===o&&n.cruiser.hit(),"cruiser1"===o&&n.cruiser1.hit(),"cruiser2"===o&&n.cruiser2.hit(),"destroyer"===o&&n.destroyer.hit(),"destroyer1"===o&&n.destroyer1.hit(),"destroyer2"===o&&n.destroyer2.hit(),"destroyer3"===o&&n.destroyer3.hit()),!0===i)break}},deployShips:(e,t,s,n,c,i,a,o,l,d)=>{const u={carrier:e,battleShip:t,battleShip1:s,cruiser:n,cruiser1:c,cruiser2:i,destroyer:a,destroyer1:o,destroyer2:l,destroyer3:d};return{carrier:r(4,0,u.carrier),battleShip:r(3,0,u.battleShip),battleShip1:r(3,0,u.battleShip1),cruiser:r(2,0,u.cruiser),cruiser1:r(2,0,u.cruiser1),cruiser2:r(2,0,u.cruiser2),destroyer:r(1,0,u.destroyer),destroyer1:r(1,0,u.destroyer1),destroyer2:r(1,0,u.destroyer2),destroyer3:r(1,0,u.destroyer3),coordinates:u}},receivedAttacks:t,successAttacks:s,checkSunk:e=>{return!((r=e).carrier.currentCords&&!r.carrier.isSunk()||r.battleShip.currentCords&&!r.battleShip.isSunk()||r.battleShip1.currentCords&&!r.battleShip1.isSunk()||r.cruiser.currentCords&&!r.cruiser.isSunk()||r.cruiser1.currentCords&&!r.cruiser1.isSunk()||r.cruiser2.currentCords&&!r.cruiser2.isSunk()||r.destroyer.currentCords&&!r.destroyer.isSunk()||r.destroyer1.currentCords&&!r.destroyer1.isSunk()||r.destroyer2.currentCords&&!r.destroyer2.isSunk()||r.destroyer3.currentCords&&!r.destroyer3.isSunk());var r}}}}})(),s=(e,r)=>{const s=e,n=r,c=t.Gameboard(),i=c.deployShips(...r);return{playerName:s,playerCoords:n,playerBoard:c,playerShips:i,receiveAttack:e=>c.receiveAttack(e,i)}},n=(s,n)=>{const c=s,i=n,a=t.Gameboard(),o=a.deployShips(...n),l=[],d=t=>{const s=e=>Math.floor(Math.random()*e),n=[s(9),s(9)];if(e(l,t))return d();if(e(l,n))return d();if(!t)return l.push(t),c.receiveAttack(t);c.receiveAttack(n);const i=c.playerBoard.successAttacks;return console.log(n),console.log(i),e(i,n)?r(n,!0,"player"):r(n,!1,"player")};return{attackPlayer:d,cpuBoard:a,cpuShips:o,cpuCoords:i,receiveAttack:e=>a.receiveAttack(e,o)}},c=(e,r,t)=>{const c=s(e,r);return{Player:c,cpuPlayer:n(c,t)}},i=(()=>{const t=(t,s)=>{const n=s.Player.playerShips.coordinates,c=s.cpuPlayer.cpuShips.coordinates,i=e=>s.Player.receiveAttack(e),a=e=>s.cpuPlayer.receiveAttack(e),o=(r,t,s)=>{let n=!1;if(e(Object.values(r),t))return s(t),n=!0,!0;for(let c=0;c<r.length;c++){const i=r[c];if(e(i,t)){s(t),n=!0;break}}return n},l=(e,r)=>(r(e),!1),d=e=>{const t=e.target.parentElement.className,s=e.target.className,d=(e=>{const r=[],t=e.slice(0,1),s=e.slice(2,3);return r.push(Number(t)),r.push(Number(s)),r})(s);if("grid-1"===t){const e=Object.values(n).filter((e=>void 0!==e));!0===o(e,d,i)?r(s,!0,"player"):(l(d,i),r(s,!1,"player"))}if("grid-2"===t){const e=Object.values(c).filter((e=>void 0!==e));!0===o(e,d,a)?r(s,!0,"cpu"):(l(d,a),r(s,!1,"cpu"))}};for(let e=0;e<t.length;e++)t[e].addEventListener("click",(e=>{d(e)}),{once:!0});return{visualIndicators:r}};return{startGame:(e,r,s,n)=>{const i=c("example",s,n);return"shown-grid"!==e.className&&t(e.childNodes,i),"shown-grid"!==r.className&&t(r.childNodes,i),{currentGame:i,gridContainer1:e,gridContainer2:r}},displayGrid:(e,r)=>{(t=>{const s=t=>{if(10!==t){for(let s=0;s<10;s++){const n=document.createElement("div");n.className=`${t},${s}`;const c=document.createElement("div");c.className=`${t},${s}`,e&&e.appendChild(n),r&&r.appendChild(c)}s(t+1)}};s(0)})()},genDOMElements:()=>{const e=(e,r)=>{const t=document.getElementsByClassName(e)[r-1];t&&(t.style.border="1px solid green")};return{genGrid:(r,t)=>{const s=document.createElement("section");s.className="grids-container";const n=document.querySelector("main");n&&n.appendChild(s);const c=document.createElement("h3");c.textContent=`Player's ${r} Grid`,s.appendChild(c);const a=document.createElement("div");return a.className=`grid-${r}`,s.appendChild(a),1===r?i.displayGrid(a,null):i.displayGrid(null,a),t&&(a.className="shown-grid",((r,t)=>{const s=(e=>{const r=[];for(let t=0;t<e.length;t++){const s=e[t];"object"==typeof s[0]?r.push(...s):r.push(s)}return r})(r);for(let r=0;r<s.length;r++)e(`${(n=s[r]).slice(0,1)},${n.slice(1,2)}`,t);var n})(t,r)),a},deleteElements:()=>{const e=document.getElementsByClassName("grids-container")[0];e&&e.remove()},genStartButton:()=>{const e=document.createElement("button");e.className="start-button",e.textContent="Start Game";const r=document.getElementsByClassName("grids-container")[0];r&&r.appendChild(e)}}},endGame:e=>{const r=document.getElementsByClassName("grid-1")[0],t=document.getElementsByClassName("grid-2")[0];r&&r.replaceWith(r.cloneNode(!0)),t&&t.replaceWith(t.cloneNode(!0))}}})();(()=>{const e=[[[0,1],[0,2],[0,3],[0,4]],[[2,1],[3,1],[4,1]],[[0,6],[0,7],[0,8]],[[3,3],[3,4]],[[6,3],[6,2]],[[6,8],[6,9]],[7,5],[9,2],[9,9],[8,7]],r=i.genDOMElements(),t=()=>{r.deleteElements();const t=i.startGame(r.genGrid(1,e),r.genGrid(2),e,e),s=t.currentGame.Player,n=t.currentGame.cpuPlayer,c=((e,r)=>{const t=e.playerCoords,s=e.playerShips,n=r.cpuShips;let c=0;return{turnsLogic:()=>{let a=!1;return r.cpuBoard.receivedAttacks.length===c+1&&(c++,r.attackPlayer(t)),e.playerBoard.checkSunk(s)&&(i.endGame("player1"),a=!0),r.cpuBoard.checkSunk(n)&&(i.endGame("player2"),a=!0),a}}})(s,n);return((e,r)=>{for(let t=0;t<r.childNodes.length;t++)r.childNodes[t].addEventListener("click",e.turnsLogic)})(c,t.gridContainer2),{playerObj:s,cpuObj:n,currentTurn:c}};return{singlePlayer:t,setupDOM:()=>{r.genGrid(1,e),r.genStartButton();const s=document.getElementsByClassName("start-button")[0];s&&s.addEventListener("click",t)}}})().setupDOM()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MUMsWUFBWXJDLE9BQ2hDaUYsRUFBU0YsRUFBUTFDLFlBQVlwQyxVQUM3QmlGLEVBOURVLEVBQUNDLEVBQVNDLEtBRTFCLE1BQU05RSxFQUFnQjZFLEVBQVF2RyxhQUV4QnlHLEVBQWVGLEVBQVEzSSxZQUV2QjhJLEVBQWVGLEVBQVFqRyxTQUU3QixJQUFJb0csRUFBc0IsRUF1QjFCLE1BQU8sQ0FBRUMsV0FyQlUsS0FFakIsSUFBSUMsR0FBYSxFQWlCakIsT0FmSUwsRUFBUWxHLFNBQVM5QyxnQkFBZ0J0QixTQUFXeUssRUFBc0IsSUFDcEVBLElBQ0FILEVBQVEvRixhQUFhaUIsSUFHbkI2RSxFQUFRdEcsWUFBWVAsVUFBVStHLEtBQ2hDbkYsRUFBU29FLFFBQVEsV0FDakJtQixHQUFhLEdBR1hMLEVBQVFsRyxTQUFTWixVQUFVZ0gsS0FDN0JwRixFQUFTb0UsUUFBUSxXQUNqQm1CLEdBQWEsR0FHUkEsR0FFVyxFQStCQUMsQ0FBVVYsRUFBV0MsR0FlekMsTUFWaUIsRUFBQ1UsRUFBVUMsS0FFMUIsSUFBSyxJQUFJL0ssRUFBSSxFQUFHQSxFQUFJK0ssRUFBYXRELFdBQVd4SCxPQUFRRCxJQUNyQytLLEVBQWF0RCxXQUFXekgsR0FDaENtSCxpQkFBaUIsUUFBUzJELEVBQVNILFdBQzFDLEVBR0ZLLENBQVNYLEVBWk9ILEVBQVEzQyxnQkFjakIsQ0FBRTRDLFlBQVdDLFNBQVFDLGNBQVksRUFpQjFDLE1BQU8sQ0FBRUosZUFBY2dCLFNBYk4sS0FFZmpCLEVBQU9yQixRQUFRLEVBQUdvQixHQUNsQkMsRUFBT1QsaUJBRVAsTUFBTUMsRUFDSmhKLFNBQVNDLHVCQUF1QixnQkFBZ0IsR0FFOUMrSSxHQUNGQSxFQUFZckMsaUJBQWlCLFFBQVM4QyxFQUFZLEVBTXZELEVBbEdnQixHQW9HUmdCLFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxuLy8gbXVsdGlwbGUgcHVycG9zZXMgZnVuY3Rpb25zXG5jb25zdCBpc1RhcmdldEluQXJyYXkgPSAoYXJyLCB0YXJnZXQpID0+IHtcbiAgbGV0IGNvbnRhaW5zID0gZmFsc2U7XG5cbiAgaWYgKEpTT04uc3RyaW5naWZ5KGFycikgPT09IEpTT04uc3RyaW5naWZ5KHRhcmdldCkpIGNvbnRhaW5zID0gdHJ1ZTtcblxuICBpZiAoIWFycikgcmV0dXJuIGNvbnRhaW5zO1xuXG4gIGlmICghdGFyZ2V0KSByZXR1cm4gY29udGFpbnM7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBlbGVtZW50ID0gYXJyW2ldO1xuXG4gICAgaWYgKEpTT04uc3RyaW5naWZ5KGVsZW1lbnQpID09PSBKU09OLnN0cmluZ2lmeSh0YXJnZXQpKSBjb250YWlucyA9IHRydWU7XG4gIH1cblxuICByZXR1cm4gY29udGFpbnM7XG59O1xuXG5jb25zdCB2aXN1YWxJbmRpY2F0b3JzID0gKGNvb3JkLCB3YXNTdWNjZXNzZnVsLCB0YXJnZXQpID0+IHtcblxuICBsZXQgaW5kZXggPSAwXG4gIGlmICh0YXJnZXQgPT09IFwiY3B1XCIpIGluZGV4ID0gMVxuXG4gIGNvbnN0IGN1cnJlbnROb2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjb29yZClbaW5kZXhdXG4gIGlmIChjdXJyZW50Tm9kZSkge1xuICAgIGlmICh3YXNTdWNjZXNzZnVsID09PSBmYWxzZSkgY3VycmVudE5vZGUudGV4dENvbnRlbnQgPSBcIuKAolwiO1xuICAgIGVsc2Uge1xuICAgICAgY3VycmVudE5vZGUudGV4dENvbnRlbnQgPSBcIlhcIjtcbiAgICB9XG4gIH1cblxufTtcblxuY29uc3QgbWFpbk9iamVjdHMgPSAoKCkgPT4ge1xuICBjb25zdCBTaGlwID0gKGxlbmd0aE51bWJlciwgaGl0c051bWJlciwgY29vcmRzKSA9PiB7XG4gICAgY29uc3QgY3VycmVudENvcmRzID0gY29vcmRzO1xuXG4gICAgY29uc3QgY2hlY2tTdW5rID0gKGxlbmd0aCwgaGl0cykgPT4ge1xuICAgICAgaWYgKGxlbmd0aCA9PT0gaGl0cykgcmV0dXJuIHRydWU7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgIGxldCBzaGlwSGl0cyA9IGhpdHNOdW1iZXI7XG5cbiAgICBjb25zdCBzaGlwTGVuZ3RoID0gbGVuZ3RoTnVtYmVyO1xuXG4gICAgY29uc3QgaXNTdW5rID0gKCkgPT4gY2hlY2tTdW5rKHNoaXBMZW5ndGgsIHNoaXBIaXRzKTtcblxuICAgIGNvbnN0IGhpdCA9ICgpID0+IHNoaXBIaXRzKys7XG5cbiAgICBjb25zdCBjdXJyZW50SGl0cyA9ICgpID0+IHNoaXBIaXRzO1xuXG4gICAgcmV0dXJuIHsgaXNTdW5rLCBoaXQsIGN1cnJlbnRIaXRzLCBjdXJyZW50Q29yZHMsIHNoaXBMZW5ndGggfTtcbiAgfTtcblxuICBjb25zdCBHYW1lYm9hcmQgPSAoKSA9PiB7XG4gICAgY29uc3QgZGVwbG95U2hpcHMgPSAoXG4gICAgICBjYXJyaWVyQ29yZHMsXG4gICAgICBiYXR0bGVTaGlwQ29yZHMsXG4gICAgICBiYXR0bGVTaGlwMUNvcmRzLFxuICAgICAgY3J1aXNlckNvcmRzLFxuICAgICAgY3J1aXNlcjFDb3JkcyxcbiAgICAgIGNydWlzZXIyQ29yZHMsXG4gICAgICBkZXN0cm95ZXJDb3JkcyxcbiAgICAgIGRlc3Ryb3llcjFDb3JkcyxcbiAgICAgIGRlc3Ryb3llcjJDb3JkcyxcbiAgICAgIGRlc3Ryb3llcjNDb3Jkc1xuICAgICkgPT4ge1xuICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSB7XG4gICAgICAgIGNhcnJpZXI6IGNhcnJpZXJDb3JkcyxcbiAgICAgICAgYmF0dGxlU2hpcDogYmF0dGxlU2hpcENvcmRzLFxuICAgICAgICBiYXR0bGVTaGlwMTogYmF0dGxlU2hpcDFDb3JkcyxcbiAgICAgICAgY3J1aXNlcjogY3J1aXNlckNvcmRzLFxuICAgICAgICBjcnVpc2VyMTogY3J1aXNlcjFDb3JkcyxcbiAgICAgICAgY3J1aXNlcjI6IGNydWlzZXIyQ29yZHMsXG4gICAgICAgIGRlc3Ryb3llcjogZGVzdHJveWVyQ29yZHMsXG4gICAgICAgIGRlc3Ryb3llcjE6IGRlc3Ryb3llcjFDb3JkcyxcbiAgICAgICAgZGVzdHJveWVyMjogZGVzdHJveWVyMkNvcmRzLFxuICAgICAgICBkZXN0cm95ZXIzOiBkZXN0cm95ZXIzQ29yZHMsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjYXJyaWVyID0gU2hpcCg0LCAwLCBjb29yZGluYXRlcy5jYXJyaWVyKTtcblxuICAgICAgY29uc3QgYmF0dGxlU2hpcCA9IFNoaXAoMywgMCwgY29vcmRpbmF0ZXMuYmF0dGxlU2hpcCk7XG5cbiAgICAgIGNvbnN0IGJhdHRsZVNoaXAxID0gU2hpcCgzLCAwLCBjb29yZGluYXRlcy5iYXR0bGVTaGlwMSk7XG5cbiAgICAgIGNvbnN0IGNydWlzZXIgPSBTaGlwKDIsIDAsIGNvb3JkaW5hdGVzLmNydWlzZXIpO1xuXG4gICAgICBjb25zdCBjcnVpc2VyMSA9IFNoaXAoMiwgMCwgY29vcmRpbmF0ZXMuY3J1aXNlcjEpO1xuXG4gICAgICBjb25zdCBjcnVpc2VyMiA9IFNoaXAoMiwgMCwgY29vcmRpbmF0ZXMuY3J1aXNlcjIpO1xuXG4gICAgICBjb25zdCBkZXN0cm95ZXIgPSBTaGlwKDEsIDAsIGNvb3JkaW5hdGVzLmRlc3Ryb3llcik7XG5cbiAgICAgIGNvbnN0IGRlc3Ryb3llcjEgPSBTaGlwKDEsIDAsIGNvb3JkaW5hdGVzLmRlc3Ryb3llcjEpO1xuXG4gICAgICBjb25zdCBkZXN0cm95ZXIyID0gU2hpcCgxLCAwLCBjb29yZGluYXRlcy5kZXN0cm95ZXIyKTtcblxuICAgICAgY29uc3QgZGVzdHJveWVyMyA9IFNoaXAoMSwgMCwgY29vcmRpbmF0ZXMuZGVzdHJveWVyMyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhcnJpZXIsXG4gICAgICAgIGJhdHRsZVNoaXAsXG4gICAgICAgIGJhdHRsZVNoaXAxLFxuICAgICAgICBjcnVpc2VyLFxuICAgICAgICBjcnVpc2VyMSxcbiAgICAgICAgY3J1aXNlcjIsXG4gICAgICAgIGRlc3Ryb3llcixcbiAgICAgICAgZGVzdHJveWVyMSxcbiAgICAgICAgZGVzdHJveWVyMixcbiAgICAgICAgZGVzdHJveWVyMyxcbiAgICAgICAgY29vcmRpbmF0ZXMsXG4gICAgICB9O1xuICAgIH07XG5cbiAgICBjb25zdCByZWNlaXZlZEF0dGFja3MgPSBbXTtcblxuICAgIGNvbnN0IHN1Y2Nlc3NBdHRhY2tzID0gW107XG5cbiAgICBjb25zdCByZWNlaXZlQXR0YWNrID0gKHRhcmdldENvcmRzLCBwbGF5ZXJTaGlwcykgPT4ge1xuICAgICAgY29uc3QgY3VycmVudFNoaXBzID0gT2JqZWN0LmVudHJpZXMocGxheWVyU2hpcHMuY29vcmRpbmF0ZXMpO1xuICAgICAgcmVjZWl2ZWRBdHRhY2tzLnB1c2godGFyZ2V0Q29yZHMpXG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VycmVudFNoaXBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBzdWNjZXNzID0gZmFsc2U7XG5cbiAgICAgICAgY29uc3Qgc2hpcENvcmRzID0gY3VycmVudFNoaXBzW2ldWzFdO1xuXG4gICAgICAgIGNvbnN0IHNoaXBOYW1lID0gY3VycmVudFNoaXBzW2ldWzBdO1xuXG4gICAgICAgIGlmIChpc1RhcmdldEluQXJyYXkoc2hpcENvcmRzLCB0YXJnZXRDb3JkcykpIHtcbiAgICAgICAgICBzdWNjZXNzID0gdHJ1ZTtcblxuICAgICAgICAgIHN1Y2Nlc3NBdHRhY2tzLnB1c2godGFyZ2V0Q29yZHMpO1xuXG4gICAgICAgICAgLy8gaWYgdGhlIHRhcmdldCBjb3JkcyBtYXRjaGVzIGEgc2hpcCBjb3Jkcy5cbiAgICAgICAgICBpZiAoc2hpcE5hbWUgPT09IFwiY2FycmllclwiKSBwbGF5ZXJTaGlwcy5jYXJyaWVyLmhpdCgpO1xuICAgICAgICAgIGlmIChzaGlwTmFtZSA9PT0gXCJiYXR0bGVTaGlwXCIpIHBsYXllclNoaXBzLmJhdHRsZVNoaXAuaGl0KCk7XG4gICAgICAgICAgaWYgKHNoaXBOYW1lID09PSBcImJhdHRsZVNoaXAxXCIpIHBsYXllclNoaXBzLmJhdHRsZVNoaXAxLmhpdCgpO1xuICAgICAgICAgIGlmIChzaGlwTmFtZSA9PT0gXCJjcnVpc2VyXCIpIHBsYXllclNoaXBzLmNydWlzZXIuaGl0KCk7XG4gICAgICAgICAgaWYgKHNoaXBOYW1lID09PSBcImNydWlzZXIxXCIpIHBsYXllclNoaXBzLmNydWlzZXIxLmhpdCgpO1xuICAgICAgICAgIGlmIChzaGlwTmFtZSA9PT0gXCJjcnVpc2VyMlwiKSBwbGF5ZXJTaGlwcy5jcnVpc2VyMi5oaXQoKTtcbiAgICAgICAgICBpZiAoc2hpcE5hbWUgPT09IFwiZGVzdHJveWVyXCIpIHBsYXllclNoaXBzLmRlc3Ryb3llci5oaXQoKTtcbiAgICAgICAgICBpZiAoc2hpcE5hbWUgPT09IFwiZGVzdHJveWVyMVwiKSBwbGF5ZXJTaGlwcy5kZXN0cm95ZXIxLmhpdCgpO1xuICAgICAgICAgIGlmIChzaGlwTmFtZSA9PT0gXCJkZXN0cm95ZXIyXCIpIHBsYXllclNoaXBzLmRlc3Ryb3llcjIuaGl0KCk7XG4gICAgICAgICAgaWYgKHNoaXBOYW1lID09PSBcImRlc3Ryb3llcjNcIikgcGxheWVyU2hpcHMuZGVzdHJveWVyMy5oaXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdWNjZXNzID09PSB0cnVlKSBicmVhaztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgY2hlY2tTdW5rID0gKHBsYXllclNoaXBzKSA9PiB7XG4gICAgICBjb25zdCBhcmVBbGxTdW5rID0gKHNoaXBzKSA9PiB7XG4gICAgICAgIC8vIGVpdGhlciB3ZSBkaWRuJ3QgZGVmaW5lZCB0aGUgY29yZHMgb2YgYSBzaGlwICh1bmRlZmluZWQpLCBvciBpdCBpcyBhY3R1YWxseSBzdW5rLCB3ZSB0YWtlIHRoYXQgYXMgdHJ1ZS5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICghc2hpcHMuY2Fycmllci5jdXJyZW50Q29yZHMgfHxcbiAgICAgICAgICAgIHNoaXBzLmNhcnJpZXIuaXNTdW5rKCkpICYmXG4gICAgICAgICAgKCFzaGlwcy5iYXR0bGVTaGlwLmN1cnJlbnRDb3JkcyB8fFxuICAgICAgICAgICAgc2hpcHMuYmF0dGxlU2hpcC5pc1N1bmsoKSkgJiZcbiAgICAgICAgICAoIXNoaXBzLmJhdHRsZVNoaXAxLmN1cnJlbnRDb3JkcyB8fFxuICAgICAgICAgICAgc2hpcHMuYmF0dGxlU2hpcDEuaXNTdW5rKCkpICYmXG4gICAgICAgICAgKCFzaGlwcy5jcnVpc2VyLmN1cnJlbnRDb3JkcyB8fFxuICAgICAgICAgICAgc2hpcHMuY3J1aXNlci5pc1N1bmsoKSkgJiZcbiAgICAgICAgICAoIXNoaXBzLmNydWlzZXIxLmN1cnJlbnRDb3JkcyB8fFxuICAgICAgICAgICAgc2hpcHMuY3J1aXNlcjEuaXNTdW5rKCkpICYmXG4gICAgICAgICAgKCFzaGlwcy5jcnVpc2VyMi5jdXJyZW50Q29yZHMgfHxcbiAgICAgICAgICAgIHNoaXBzLmNydWlzZXIyLmlzU3VuaygpKSAmJlxuICAgICAgICAgICghc2hpcHMuZGVzdHJveWVyLmN1cnJlbnRDb3JkcyB8fFxuICAgICAgICAgICAgc2hpcHMuZGVzdHJveWVyLmlzU3VuaygpKSAmJlxuICAgICAgICAgICghc2hpcHMuZGVzdHJveWVyMS5jdXJyZW50Q29yZHMgfHxcbiAgICAgICAgICAgIHNoaXBzLmRlc3Ryb3llcjEuaXNTdW5rKCkpICYmXG4gICAgICAgICAgKCFzaGlwcy5kZXN0cm95ZXIyLmN1cnJlbnRDb3JkcyB8fFxuICAgICAgICAgICAgc2hpcHMuZGVzdHJveWVyMi5pc1N1bmsoKSkgJiZcbiAgICAgICAgICAoIXNoaXBzLmRlc3Ryb3llcjMuY3VycmVudENvcmRzIHx8XG4gICAgICAgICAgICBzaGlwcy5kZXN0cm95ZXIzLmlzU3VuaygpKVxuICAgICAgICApXG4gICAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIGFyZUFsbFN1bmsocGxheWVyU2hpcHMpO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgcmVjZWl2ZUF0dGFjayxcbiAgICAgIGRlcGxveVNoaXBzLFxuICAgICAgcmVjZWl2ZWRBdHRhY2tzLFxuICAgICAgc3VjY2Vzc0F0dGFja3MsXG4gICAgICBjaGVja1N1bmssXG4gICAgfTtcbiAgfTtcblxuICByZXR1cm4geyBTaGlwLCBHYW1lYm9hcmQgfTtcbn0pKCk7XG5cbmNvbnN0IHBsYXllckxvZ2ljID0gKCgpID0+IHtcbiAgY29uc3QgUGxheWVyID0gKG5hbWUsIHNoaXBzQ29vcmRzKSA9PiB7XG4gICAgY29uc3QgcGxheWVyTmFtZSA9IG5hbWU7XG5cbiAgICBjb25zdCBwbGF5ZXJDb29yZHMgPSBzaGlwc0Nvb3Jkc1xuXG4gICAgY29uc3QgcGxheWVyQm9hcmQgPSBtYWluT2JqZWN0cy5HYW1lYm9hcmQoKTtcblxuICAgIGNvbnN0IHBsYXllclNoaXBzID0gcGxheWVyQm9hcmQuZGVwbG95U2hpcHMoLi4uc2hpcHNDb29yZHMpO1xuXG4gICAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlcykgPT5cbiAgICAgIHBsYXllckJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZXMsIHBsYXllclNoaXBzKTtcblxuXG4gICAgcmV0dXJuIHsgcGxheWVyTmFtZSwgcGxheWVyQ29vcmRzLCBwbGF5ZXJCb2FyZCwgcGxheWVyU2hpcHMsIHJlY2VpdmVBdHRhY2sgfTtcbiAgfTtcblxuICBjb25zdCBjcHVQbGF5ZXIgPSAoaHVtYW5QbGF5ZXIsIHNoaXBzQ29yZHMpID0+IHtcbiAgICBjb25zdCByaXZhbFBsYXllciA9IGh1bWFuUGxheWVyO1xuXG4gICAgY29uc3QgY3B1Q29vcmRzID0gc2hpcHNDb3Jkc1xuXG4gICAgY29uc3QgY3B1Qm9hcmQgPSBtYWluT2JqZWN0cy5HYW1lYm9hcmQoKTtcblxuICAgIGNvbnN0IGNwdVNoaXBzID0gY3B1Qm9hcmQuZGVwbG95U2hpcHMoLi4uc2hpcHNDb3Jkcyk7XG5cbiAgICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PlxuICAgICAgY3B1Qm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlcywgY3B1U2hpcHMpO1xuXG4gICAgY29uc3QgdXNlZENvb3JkcyA9IFtdO1xuXG4gICAgY29uc3QgYXR0YWNrUGxheWVyID0gKGNvb3JkcykgPT4ge1xuXG4gICAgICBjb25zdCByYW5kb21JbnQgPSAobWF4KSA9PiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXgpO1xuXG4gICAgICBjb25zdCByYW5kb21Db29yZHMgPSBbcmFuZG9tSW50KDkpLCByYW5kb21JbnQoOSldO1xuXG4gICAgICAvLyBjYWxsIHRoZSBmdW5jdGlvbiBhZ2FpbiBhbmQgZ2VuZXJhdGUgbmV3IHJhbmRvbSBjb29yZHMgaWYgdGhlIGF0dGFjayBoYXMgYWxyZWFkeSBiZSBkb25lIGluIHRoYXQgY29vcmRpbmF0ZS5cbiAgICAgIGlmIChpc1RhcmdldEluQXJyYXkodXNlZENvb3JkcywgY29vcmRzKSkgcmV0dXJuIGF0dGFja1BsYXllcigpO1xuXG4gICAgICBpZiAoaXNUYXJnZXRJbkFycmF5KHVzZWRDb29yZHMsIHJhbmRvbUNvb3JkcykpIHJldHVybiBhdHRhY2tQbGF5ZXIoKTtcblxuICAgICAgaWYgKCFjb29yZHMpIHtcbiAgICAgICAgLy8gaWYgd2Ugc2V0IG1hbnVhbCBlbXB0eSBjb29yZHMgZm9yIHRlc3Rpbmcgb3IgYW5vdGhlciBwdXJwb3Nlcy5cbiAgICAgICAgdXNlZENvb3Jkcy5wdXNoKGNvb3Jkcyk7XG4gICAgICAgIHJldHVybiByaXZhbFBsYXllci5yZWNlaXZlQXR0YWNrKGNvb3Jkcyk7XG4gICAgICB9XG4gICAgICByaXZhbFBsYXllci5yZWNlaXZlQXR0YWNrKHJhbmRvbUNvb3Jkcyk7IC8vIG1ha2UgdGhlIGF0dGFja1xuICAgICAgY29uc3Qgcml2YWxQbGF5ZXJIaXRzID0gcml2YWxQbGF5ZXIucGxheWVyQm9hcmQuc3VjY2Vzc0F0dGFja3NcblxuICAgICAgY29uc29sZS5sb2cocmFuZG9tQ29vcmRzKVxuICAgICAgY29uc29sZS5sb2cocml2YWxQbGF5ZXJIaXRzKVxuICAgICAgaWYgKGlzVGFyZ2V0SW5BcnJheShyaXZhbFBsYXllckhpdHMsIHJhbmRvbUNvb3JkcykpIHsgLy8gY2hlY2sgaWYgaXQgd2FzIGEgc3VjY2Vzc2Z1bCBhdHRhY2sgb3Igbm90LlxuICAgICAgICByZXR1cm4gdmlzdWFsSW5kaWNhdG9ycyhyYW5kb21Db29yZHMsIHRydWUsIFwicGxheWVyXCIpXG4gICAgICB9XG4gICAgICByZXR1cm4gdmlzdWFsSW5kaWNhdG9ycyhyYW5kb21Db29yZHMsIGZhbHNlLCBcInBsYXllclwiKVxuXG4gICAgfTtcblxuICAgIHJldHVybiB7IGF0dGFja1BsYXllciwgY3B1Qm9hcmQsIGNwdVNoaXBzLCBjcHVDb29yZHMsIHJlY2VpdmVBdHRhY2sgfTtcbiAgfTtcblxuICByZXR1cm4geyBQbGF5ZXIsIGNwdVBsYXllciB9O1xufSkoKTtcblxuY29uc3QgR2FtZSA9ICgoKSA9PiB7XG4gIGNvbnN0IG5ld0dhbWUgPSAocGxheWVyTmFtZSwgcGxheWVyQ29vcmRzLCBjcHVDb29yZHMpID0+IHtcbiAgICBjb25zdCBQbGF5ZXIgPSBwbGF5ZXJMb2dpYy5QbGF5ZXIocGxheWVyTmFtZSwgcGxheWVyQ29vcmRzKTtcblxuICAgIGNvbnN0IGNwdVBsYXllciA9IHBsYXllckxvZ2ljLmNwdVBsYXllcihQbGF5ZXIsIGNwdUNvb3Jkcyk7XG5cbiAgICByZXR1cm4geyBQbGF5ZXIsIGNwdVBsYXllciB9O1xuICB9O1xuXG4gIHJldHVybiB7IG5ld0dhbWUgfTtcbn0pKCk7XG5cbmNvbnN0IERPTUxvZ2ljID0gKCgpID0+IHtcbiAgY29uc3QgZGlzcGxheUdyaWQgPSAoZ3JpZDEsIGdyaWQyKSA9PiB7XG4gICAgY29uc3QgY3JlYXRlR3JpZCA9IChzaXplKSA9PiB7XG4gICAgICBjb25zdCByZWN1cnNpdmUgPSAoeVBvcykgPT4ge1xuICAgICAgICBpZiAoeVBvcyA9PT0gc2l6ZSkgcmV0dXJuO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgZ3JpZEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgIGdyaWRFbGVtZW50LmNsYXNzTmFtZSA9IGAke3lQb3N9LCR7aX1gO1xuXG4gICAgICAgICAgY29uc3QgZ3JpZEVsZW1lbnQyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICBncmlkRWxlbWVudDIuY2xhc3NOYW1lID0gYCR7eVBvc30sJHtpfWA7XG5cbiAgICAgICAgICBpZiAoZ3JpZDEpXG4gICAgICAgICAgICBncmlkMS5hcHBlbmRDaGlsZChncmlkRWxlbWVudCk7XG4gICAgICAgICAgaWYgKGdyaWQyKVxuICAgICAgICAgICAgZ3JpZDIuYXBwZW5kQ2hpbGQoZ3JpZEVsZW1lbnQyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlY3Vyc2l2ZSh5UG9zICsgMSk7XG4gICAgICB9O1xuICAgICAgcmVjdXJzaXZlKDApO1xuICAgIH07XG5cbiAgICBjcmVhdGVHcmlkKDEwKTtcbiAgfTtcblxuICBjb25zdCBVSUxvZ2ljID0gKG5vZGVzLCBnYW1lSW5mbykgPT4ge1xuXG4gICAgY29uc3QgcGxheWVyMUNvb3JkcyA9IGdhbWVJbmZvLlBsYXllci5wbGF5ZXJTaGlwcy5jb29yZGluYXRlcztcblxuICAgIGNvbnN0IHBsYXllcjJDb29yZHMgPSBnYW1lSW5mby5jcHVQbGF5ZXIuY3B1U2hpcHMuY29vcmRpbmF0ZXM7XG5cbiAgICBjb25zdCBhdHRhY2tQbGF5ZXIgPSAoY29vcmQpID0+IGdhbWVJbmZvLlBsYXllci5yZWNlaXZlQXR0YWNrKGNvb3JkKTtcblxuICAgIGNvbnN0IGF0dGFja0NwdSA9IChjb29yZCkgPT4gZ2FtZUluZm8uY3B1UGxheWVyLnJlY2VpdmVBdHRhY2soY29vcmQpO1xuXG4gICAgY29uc3QgYXR0YWNrT25DbGljayA9IChzaGlwQ29vcmRzLCBub2RlQ29vcmQsIGF0dGFja0Z1bmN0aW9uKSA9PiB7XG4gICAgICAvLyBpZiB0aGUgcGxheWVyIGhhcyBhIHNoaXAgaW4gdGhlIGNsaWNrZWQgY29vcmRpbmF0ZSwgYXR0YWNrIHRoZSBwbGF5ZXIgdG8gdGhhdCBzcGVjaWZpYyBjb29yZC5cbiAgICAgIGxldCB3YXNTdWNjZXNzZnVsID0gZmFsc2U7XG4gICAgICBpZiAoaXNUYXJnZXRJbkFycmF5KE9iamVjdC52YWx1ZXMoc2hpcENvb3JkcyksIG5vZGVDb29yZCkpIHtcbiAgICAgICAgLy8gd2hlbiB0aGUgbm9kZUNvb3JkIGlzIGluc2lkZSBvZiBhIG9uZS1jb29yZGluYXRlIHNoaXAsIHRoaXMgY29uZGl0aW9uYWwgaXMgdXNlZC5cbiAgICAgICAgYXR0YWNrRnVuY3Rpb24obm9kZUNvb3JkKTtcbiAgICAgICAgd2FzU3VjY2Vzc2Z1bCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgICAvLyB3aGVuIHRoZSBub2RlQ29vcmQgaXMgaW5zaWRlIG9mIGEgbXVsdGlwbGUtY29vcmRpbmF0ZSBzaGlwLlxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwQ29vcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIC8vIGxvb3AgdGhyb3VnaCB0aGUgY29vcmRzIGFycmF5IG9mIGVhY2ggc2hpcCwgdW50aWwgdGhlIG5vZGVDb29yZCBpcyBmb3VuZC5cbiAgICAgICAgY29uc3QgY3VycmVudENvb3JkcyA9IHNoaXBDb29yZHNbaV07XG4gICAgICAgIGlmIChpc1RhcmdldEluQXJyYXkoY3VycmVudENvb3Jkcywgbm9kZUNvb3JkKSkge1xuICAgICAgICAgIGF0dGFja0Z1bmN0aW9uKG5vZGVDb29yZCk7XG4gICAgICAgICAgd2FzU3VjY2Vzc2Z1bCA9IHRydWU7XG5cbiAgICAgICAgICBicmVhazsgLy8gc3RvcCBsb29waW5nIHRocm91Z2ggdGhlIHNoaXBzIGNvb3JkcyB0byBvcHRpbWl6ZSB0aW1lIGNvbXBsZXhpdHkuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB3YXNTdWNjZXNzZnVsO1xuICAgIH07XG5cbiAgICAvLyBub3RlLCB0aGUgYXR0YWNrT25DbGljayBmdW5jdGlvbiB3aWxsIGFsd2F5cyBjYWxsIHRoZSBhdHRhY2tGdW5jdGlvbiBvbiBhIHN1Y2Nlc3NmdWwgYXR0YWNrLlxuICAgIC8vIHRoYXQncyB3aHkgd2Ugd2lsbCBuZWVkIHRoZSBuZXh0IGZ1bmN0aW9uLlxuXG4gICAgY29uc3QgbWlzc2VkQXR0YWNrT25DbGljayA9IChub2RlQ29vcmQsIGF0dGFja0Z1bmN0aW9uKSA9PiB7XG4gICAgICBhdHRhY2tGdW5jdGlvbihub2RlQ29vcmQpXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICBjb25zdCBjbGFzc1RvQXJyYXkgPSAoY2xhc3NDb29yZCkgPT4ge1xuICAgICAgY29uc3QgYXJyYXlDb29yZCA9IFtdO1xuXG4gICAgICBjb25zdCB4ID0gY2xhc3NDb29yZC5zbGljZSgwLCAxKTtcbiAgICAgIGNvbnN0IHkgPSBjbGFzc0Nvb3JkLnNsaWNlKDIsIDMpO1xuXG4gICAgICBhcnJheUNvb3JkLnB1c2goTnVtYmVyKHgpKTtcbiAgICAgIGFycmF5Q29vcmQucHVzaChOdW1iZXIoeSkpO1xuXG4gICAgICByZXR1cm4gYXJyYXlDb29yZDtcbiAgICB9O1xuXG4gICAgY29uc3QgZGV0ZWN0QXR0YWNrcyA9IChlKSA9PiB7XG5cbiAgICAgIGNvbnN0IHBhcmVudENsYXNzID0gZS50YXJnZXQucGFyZW50RWxlbWVudC5jbGFzc05hbWU7XG5cbiAgICAgIGNvbnN0IG5vZGVDbGFzcyA9IGUudGFyZ2V0LmNsYXNzTmFtZTtcblxuICAgICAgY29uc3Qgbm9kZUNvb3JkID0gY2xhc3NUb0FycmF5KG5vZGVDbGFzcyk7XG5cbiAgICAgIGlmIChwYXJlbnRDbGFzcyA9PT0gXCJncmlkLTFcIikge1xuICAgICAgICAvLyBpZiB0aGUgY2xpY2tlZCBjb29yZGluYXRlIGlzIGluc2lkZSBvZiBncmlkLTEsIHdlIGtub3cgdGhhdCBpdCBpcyBhbiBhdHRhY2sgdG8gcGxheWVyMS5cblxuICAgICAgICBjb25zdCBjbGVhbkNvb3JkcyA9IE9iamVjdC52YWx1ZXMocGxheWVyMUNvb3JkcykuZmlsdGVyKFxuICAgICAgICAgIChjb29yZHMpID0+IGNvb3JkcyAhPT0gdW5kZWZpbmVkXG4gICAgICAgICk7IC8vIGZpbHRlciB1bmRlZmluZWQgY29vcmRzLlxuICAgICAgICBpZiAoYXR0YWNrT25DbGljayhjbGVhbkNvb3Jkcywgbm9kZUNvb3JkLCBhdHRhY2tQbGF5ZXIpID09PSB0cnVlKSB7XG4gICAgICAgICAgdmlzdWFsSW5kaWNhdG9ycyhub2RlQ2xhc3MsIHRydWUsIFwicGxheWVyXCIpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgbWlzc2VkQXR0YWNrT25DbGljayhub2RlQ29vcmQsIGF0dGFja1BsYXllcilcbiAgICAgICAgICB2aXN1YWxJbmRpY2F0b3JzKG5vZGVDbGFzcywgZmFsc2UsIFwicGxheWVyXCIpXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHBhcmVudENsYXNzID09PSBcImdyaWQtMlwiKSB7XG4gICAgICAgIGNvbnN0IGNsZWFuQ29vcmRzID0gT2JqZWN0LnZhbHVlcyhwbGF5ZXIyQ29vcmRzKS5maWx0ZXIoXG4gICAgICAgICAgKGNvb3JkcykgPT4gY29vcmRzICE9PSB1bmRlZmluZWRcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoYXR0YWNrT25DbGljayhjbGVhbkNvb3Jkcywgbm9kZUNvb3JkLCBhdHRhY2tDcHUpID09PSB0cnVlKSB7XG4gICAgICAgICAgdmlzdWFsSW5kaWNhdG9ycyhub2RlQ2xhc3MsIHRydWUsIFwiY3B1XCIpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgbWlzc2VkQXR0YWNrT25DbGljayhub2RlQ29vcmQsIGF0dGFja0NwdSlcbiAgICAgICAgICB2aXN1YWxJbmRpY2F0b3JzKG5vZGVDbGFzcywgZmFsc2UsIFwiY3B1XCIpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgbm9kZXNbaV0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7IGRldGVjdEF0dGFja3MoZSkgfSwgeyBvbmNlOiB0cnVlIH0pO1xuXG4gICAgfTtcblxuICAgIHJldHVybiB7IHZpc3VhbEluZGljYXRvcnMgfVxuICB9XG5cbiAgY29uc3Qgc3RhcnRHYW1lID0gKFxuICAgIGdyaWRDb250YWluZXIxLFxuICAgIGdyaWRDb250YWluZXIyLFxuICAgIHBsYXllckNvb3JkcyxcbiAgICBjcHVDb29yZHNcbiAgKSA9PiB7XG4gICAgY29uc3QgY3VycmVudEdhbWUgPSBHYW1lLm5ld0dhbWUoXCJleGFtcGxlXCIsIHBsYXllckNvb3JkcywgY3B1Q29vcmRzKTtcblxuICAgIGlmIChncmlkQ29udGFpbmVyMS5jbGFzc05hbWUgIT09IFwic2hvd24tZ3JpZFwiKSB7XG4gICAgICBVSUxvZ2ljKFxuICAgICAgICBncmlkQ29udGFpbmVyMS5jaGlsZE5vZGVzLFxuICAgICAgICBjdXJyZW50R2FtZVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoZ3JpZENvbnRhaW5lcjIuY2xhc3NOYW1lICE9PSBcInNob3duLWdyaWRcIikge1xuICAgICAgVUlMb2dpYyhcbiAgICAgICAgZ3JpZENvbnRhaW5lcjIuY2hpbGROb2RlcyxcbiAgICAgICAgY3VycmVudEdhbWVcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgY3VycmVudEdhbWUsIGdyaWRDb250YWluZXIxLCBncmlkQ29udGFpbmVyMiB9O1xuICB9O1xuXG4gIGNvbnN0IGdlbkRPTUVsZW1lbnRzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNvb3JkVG9DbGFzcyA9IChhcnIpID0+IGAke2Fyci5zbGljZSgwLCAxKX0sJHthcnIuc2xpY2UoMSwgMil9YDtcblxuICAgIGNvbnN0IGNoYW5nZUNvb3JkQ29sb3IgPSAoY2xhc3NOYW1lLCBncmlkTnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50Q29vcmQgPVxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSlbZ3JpZE51bWJlciAtIDFdO1xuXG4gICAgICBpZiAoY3VycmVudENvb3JkKVxuICAgICAgICBjdXJyZW50Q29vcmQuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgZ3JlZW5cIjtcbiAgICB9O1xuXG4gICAgY29uc3QgZmxhdENvb3JkcyA9IChjb29yZHNBcnIpID0+IHtcbiAgICAgIGNvbnN0IG9uZURpbWVuc2lvbkNvb3JkcyA9IFtdO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb3Jkc0Fyci5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBjb29yZHMgPSBjb29yZHNBcnJbaV07XG5cbiAgICAgICAgaWYgKHR5cGVvZiBjb29yZHNbMF0gPT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgb25lRGltZW5zaW9uQ29vcmRzLnB1c2goXG4gICAgICAgICAgICAuLi5jb29yZHNcbiAgICAgICAgICApOyAvLyBpZiB0aGUgc2hpcHMgaGF2ZSBtb3JlIHRoYW4gb25lIGNvb3JkaW5hdGUuXG4gICAgICAgIGVsc2Ugb25lRGltZW5zaW9uQ29vcmRzLnB1c2goY29vcmRzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvbmVEaW1lbnNpb25Db29yZHM7XG4gICAgfTtcblxuICAgIGNvbnN0IHNob3dTaGlwcyA9IChjdXJyZW50Q29vcmRzLCBncmlkTnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBjb29yZHMgPSBmbGF0Q29vcmRzKGN1cnJlbnRDb29yZHMpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjaGFuZ2VDb29yZENvbG9yKGNvb3JkVG9DbGFzcyhjb29yZHNbaV0pLCBncmlkTnVtYmVyKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgZGVsZXRlRWxlbWVudHMgPSAoKSA9PiB7XG4gICAgICBjb25zdCBncmlkc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJncmlkcy1jb250YWluZXJcIilbMF1cbiAgICAgIGlmIChncmlkc0NvbnRhaW5lcikgZ3JpZHNDb250YWluZXIucmVtb3ZlKClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5HcmlkID0gKHBsYXllckluZGV4LCBjb29yZHMpID0+IHtcblxuICAgICAgY29uc3QgZ3JpZHNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VjdGlvblwiKVxuICAgICAgZ3JpZHNDb250YWluZXIuY2xhc3NOYW1lID0gXCJncmlkcy1jb250YWluZXJcIlxuXG4gICAgICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1haW5cIilcbiAgICAgIGlmIChtYWluKVxuICAgICAgICBtYWluLmFwcGVuZENoaWxkKGdyaWRzQ29udGFpbmVyKVxuXG4gICAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpXG4gICAgICBuYW1lLnRleHRDb250ZW50ID0gYFBsYXllcidzICR7cGxheWVySW5kZXh9IEdyaWRgXG4gICAgICBncmlkc0NvbnRhaW5lci5hcHBlbmRDaGlsZChuYW1lKVxuXG4gICAgICBjb25zdCBncmlkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGdyaWQuY2xhc3NOYW1lID0gYGdyaWQtJHtwbGF5ZXJJbmRleH1gO1xuICAgICAgZ3JpZHNDb250YWluZXIuYXBwZW5kQ2hpbGQoZ3JpZCk7XG5cbiAgICAgIGlmIChwbGF5ZXJJbmRleCA9PT0gMSlcbiAgICAgICAgRE9NTG9naWMuZGlzcGxheUdyaWQoZ3JpZCwgbnVsbClcblxuICAgICAgZWxzZSB7XG4gICAgICAgIERPTUxvZ2ljLmRpc3BsYXlHcmlkKG51bGwsIGdyaWQpXG4gICAgICB9XG5cbiAgICAgIGlmIChjb29yZHMpIHtcbiAgICAgICAgZ3JpZC5jbGFzc05hbWUgPSBgc2hvd24tZ3JpZGBcbiAgICAgICAgc2hvd1NoaXBzKGNvb3JkcywgcGxheWVySW5kZXgpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBncmlkO1xuICAgIH07XG5cbiAgICBjb25zdCBnZW5TdGFydEJ1dHRvbiA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKVxuICAgICAgc3RhcnRCdXR0b24uY2xhc3NOYW1lID0gXCJzdGFydC1idXR0b25cIlxuICAgICAgc3RhcnRCdXR0b24udGV4dENvbnRlbnQgPSBcIlN0YXJ0IEdhbWVcIlxuICAgICAgY29uc3QgZ3JpZHNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiZ3JpZHMtY29udGFpbmVyXCIpWzBdXG4gICAgICBpZiAoZ3JpZHNDb250YWluZXIpXG4gICAgICAgIGdyaWRzQ29udGFpbmVyLmFwcGVuZENoaWxkKHN0YXJ0QnV0dG9uKVxuICAgIH1cblxuXG4gICAgcmV0dXJuIHsgZ2VuR3JpZCwgZGVsZXRlRWxlbWVudHMsIGdlblN0YXJ0QnV0dG9uIH1cbiAgfTtcblxuICBjb25zdCBlbmRHYW1lID0gKHdpbm5lcikgPT4ge1xuXG4gICAgY29uc3QgcGxheWVyMUdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiZ3JpZC0xXCIpWzBdXG5cbiAgICBjb25zdCBwbGF5ZXIyR3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJncmlkLTJcIilbMF1cblxuICAgIC8vIGNsb25lZCBlbGVtZW50cyBkbyBub3QgY2FycnkgZXZlbnQgbGlzdGVuZXJzLlxuXG4gICAgaWYgKHBsYXllcjFHcmlkKVxuICAgICAgcGxheWVyMUdyaWQucmVwbGFjZVdpdGgocGxheWVyMUdyaWQuY2xvbmVOb2RlKHRydWUpKVxuXG4gICAgaWYgKHBsYXllcjJHcmlkKVxuICAgICAgcGxheWVyMkdyaWQucmVwbGFjZVdpdGgocGxheWVyMkdyaWQuY2xvbmVOb2RlKHRydWUpKVxuXG4gIH1cblxuICByZXR1cm4geyBzdGFydEdhbWUsIGRpc3BsYXlHcmlkLCBnZW5ET01FbGVtZW50cywgZW5kR2FtZSB9O1xuXG5cbn0pKCk7XG5cbmNvbnN0IEdhbWVMb29wID0gKCgpID0+IHtcblxuICBjb25zdCBnYW1lVHVybnMgPSAocGxheWVyMSwgcGxheWVyMikgPT4ge1xuXG4gICAgY29uc3QgcGxheWVyMUNvb3JkcyA9IHBsYXllcjEucGxheWVyQ29vcmRzXG5cbiAgICBjb25zdCBwbGF5ZXIxU2hpcHMgPSBwbGF5ZXIxLnBsYXllclNoaXBzXG5cbiAgICBjb25zdCBwbGF5ZXIyU2hpcHMgPSBwbGF5ZXIyLmNwdVNoaXBzXG5cbiAgICBsZXQgcGxheWVyMkF0dGFja3NDb3VudCA9IDBcblxuICAgIGNvbnN0IHR1cm5zTG9naWMgPSAoKSA9PiB7XG5cbiAgICAgIGxldCBpc0dhbWVPdmVyID0gZmFsc2VcblxuICAgICAgaWYgKHBsYXllcjIuY3B1Qm9hcmQucmVjZWl2ZWRBdHRhY2tzLmxlbmd0aCA9PT0gcGxheWVyMkF0dGFja3NDb3VudCArIDEpIHtcbiAgICAgICAgcGxheWVyMkF0dGFja3NDb3VudCsrXG4gICAgICAgIHBsYXllcjIuYXR0YWNrUGxheWVyKHBsYXllcjFDb29yZHMpXG4gICAgICB9XG5cbiAgICAgIGlmIChwbGF5ZXIxLnBsYXllckJvYXJkLmNoZWNrU3VuayhwbGF5ZXIxU2hpcHMpKSB7XG4gICAgICAgIERPTUxvZ2ljLmVuZEdhbWUoXCJwbGF5ZXIxXCIpXG4gICAgICAgIGlzR2FtZU92ZXIgPSB0cnVlXG4gICAgICB9XG5cbiAgICAgIGlmIChwbGF5ZXIyLmNwdUJvYXJkLmNoZWNrU3VuayhwbGF5ZXIyU2hpcHMpKSB7XG4gICAgICAgIERPTUxvZ2ljLmVuZEdhbWUoXCJwbGF5ZXIyXCIpXG4gICAgICAgIGlzR2FtZU92ZXIgPSB0cnVlXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpc0dhbWVPdmVyXG4gICAgfVxuICAgIHJldHVybiB7IHR1cm5zTG9naWMgfVxuICB9XG5cbiAgY29uc3QgRXhhbXBsZUNvb3JkcyA9IFtcbiAgICBbWzAsIDFdLCBbMCwgMl0sIFswLCAzXSwgWzAsIDRdLF0sXG4gICAgW1syLCAxXSwgWzMsIDFdLCBbNCwgMV0sXSxcbiAgICBbWzAsIDZdLCBbMCwgN10sIFswLCA4XSxdLFxuICAgIFtbMywgM10sIFszLCA0XSxdLFxuICAgIFtbNiwgM10sIFs2LCAyXSxdLFxuICAgIFtbNiwgOF0sIFs2LCA5XSxdLFxuICAgIFs3LCA1XSxcbiAgICBbOSwgMl0sXG4gICAgWzksIDldLFxuICAgIFs4LCA3XSxcbiAgXTtcblxuICBjb25zdCBnZW5ET00gPSBET01Mb2dpYy5nZW5ET01FbGVtZW50cygpXG5cbiAgY29uc3Qgc2luZ2xlUGxheWVyID0gKCkgPT4ge1xuXG4gICAgZ2VuRE9NLmRlbGV0ZUVsZW1lbnRzKCkgLy8gY2xlYXIgcHJldmlvdXMgZWxlbWVudHNcblxuICAgIGNvbnN0IG5ld0dhbWUgPSBET01Mb2dpYy5zdGFydEdhbWUoXG4gICAgICBnZW5ET00uZ2VuR3JpZCgxLCBFeGFtcGxlQ29vcmRzKSxcbiAgICAgIGdlbkRPTS5nZW5HcmlkKDIpLFxuICAgICAgRXhhbXBsZUNvb3JkcyxcbiAgICAgIEV4YW1wbGVDb29yZHNcbiAgICApO1xuXG4gICAgY29uc3QgcGxheWVyT2JqID0gbmV3R2FtZS5jdXJyZW50R2FtZS5QbGF5ZXJcbiAgICBjb25zdCBjcHVPYmogPSBuZXdHYW1lLmN1cnJlbnRHYW1lLmNwdVBsYXllclxuICAgIGNvbnN0IGN1cnJlbnRUdXJuID0gZ2FtZVR1cm5zKHBsYXllck9iaiwgY3B1T2JqKVxuICAgIGNvbnN0IGNwdUdyaWQgPSBuZXdHYW1lLmdyaWRDb250YWluZXIyXG5cbiAgICAvLyByZWNlaXZlIGNvb3JkcywgZ3JpZCBjb250YWluZXJzIGFuZCBzdGFydCB0aGUgZ2FtZS5cblxuICAgIGNvbnN0IHR1cm5Mb29wID0gKGdhbWVUdXJuLCB0b0F0dGFja0dyaWQpID0+IHtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b0F0dGFja0dyaWQuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBub2RlID0gdG9BdHRhY2tHcmlkLmNoaWxkTm9kZXNbaV07XG4gICAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGdhbWVUdXJuLnR1cm5zTG9naWMpXG4gICAgICB9XG4gICAgfVxuXG4gICAgdHVybkxvb3AoY3VycmVudFR1cm4sIGNwdUdyaWQpXG5cbiAgICByZXR1cm4geyBwbGF5ZXJPYmosIGNwdU9iaiwgY3VycmVudFR1cm4gfVxuXG4gIH1cblxuICBjb25zdCBzZXR1cERPTSA9ICgpID0+IHtcblxuICAgIGdlbkRPTS5nZW5HcmlkKDEsIEV4YW1wbGVDb29yZHMpXG4gICAgZ2VuRE9NLmdlblN0YXJ0QnV0dG9uKClcblxuICAgIGNvbnN0IHN0YXJ0QnV0dG9uID1cbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJzdGFydC1idXR0b25cIilbMF07XG5cbiAgICBpZiAoc3RhcnRCdXR0b24pXG4gICAgICBzdGFydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgc2luZ2xlUGxheWVyKVxuXG4gIH1cblxuICByZXR1cm4geyBzaW5nbGVQbGF5ZXIsIHNldHVwRE9NIH07XG5cbn0pKCk7XG5cbkdhbWVMb29wLnNldHVwRE9NKClcblxuXG5leHBvcnQgeyBtYWluT2JqZWN0cywgcGxheWVyTG9naWMsIEdhbWUsIERPTUxvZ2ljLCBHYW1lTG9vcCwgaXNUYXJnZXRJbkFycmF5IH07XG4iXSwibmFtZXMiOlsiaXNUYXJnZXRJbkFycmF5IiwiYXJyIiwidGFyZ2V0IiwiY29udGFpbnMiLCJKU09OIiwic3RyaW5naWZ5IiwiaSIsImxlbmd0aCIsImVsZW1lbnQiLCJ2aXN1YWxJbmRpY2F0b3JzIiwiY29vcmQiLCJ3YXNTdWNjZXNzZnVsIiwiaW5kZXgiLCJjdXJyZW50Tm9kZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsInRleHRDb250ZW50IiwibWFpbk9iamVjdHMiLCJTaGlwIiwibGVuZ3RoTnVtYmVyIiwiaGl0c051bWJlciIsImNvb3JkcyIsInNoaXBIaXRzIiwic2hpcExlbmd0aCIsImlzU3VuayIsImhpdCIsImN1cnJlbnRIaXRzIiwiY3VycmVudENvcmRzIiwiR2FtZWJvYXJkIiwicmVjZWl2ZWRBdHRhY2tzIiwic3VjY2Vzc0F0dGFja3MiLCJyZWNlaXZlQXR0YWNrIiwidGFyZ2V0Q29yZHMiLCJwbGF5ZXJTaGlwcyIsImN1cnJlbnRTaGlwcyIsIk9iamVjdCIsImVudHJpZXMiLCJjb29yZGluYXRlcyIsInB1c2giLCJzdWNjZXNzIiwic2hpcENvcmRzIiwic2hpcE5hbWUiLCJjYXJyaWVyIiwiYmF0dGxlU2hpcCIsImJhdHRsZVNoaXAxIiwiY3J1aXNlciIsImNydWlzZXIxIiwiY3J1aXNlcjIiLCJkZXN0cm95ZXIiLCJkZXN0cm95ZXIxIiwiZGVzdHJveWVyMiIsImRlc3Ryb3llcjMiLCJkZXBsb3lTaGlwcyIsImNhcnJpZXJDb3JkcyIsImJhdHRsZVNoaXBDb3JkcyIsImJhdHRsZVNoaXAxQ29yZHMiLCJjcnVpc2VyQ29yZHMiLCJjcnVpc2VyMUNvcmRzIiwiY3J1aXNlcjJDb3JkcyIsImRlc3Ryb3llckNvcmRzIiwiZGVzdHJveWVyMUNvcmRzIiwiZGVzdHJveWVyMkNvcmRzIiwiZGVzdHJveWVyM0NvcmRzIiwiY2hlY2tTdW5rIiwic2hpcHMiLCJwbGF5ZXJMb2dpYyIsIm5hbWUiLCJzaGlwc0Nvb3JkcyIsInBsYXllck5hbWUiLCJwbGF5ZXJDb29yZHMiLCJwbGF5ZXJCb2FyZCIsImh1bWFuUGxheWVyIiwic2hpcHNDb3JkcyIsInJpdmFsUGxheWVyIiwiY3B1Q29vcmRzIiwiY3B1Qm9hcmQiLCJjcHVTaGlwcyIsInVzZWRDb29yZHMiLCJhdHRhY2tQbGF5ZXIiLCJyYW5kb21JbnQiLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJyYW5kb21Db29yZHMiLCJyaXZhbFBsYXllckhpdHMiLCJjb25zb2xlIiwibG9nIiwiR2FtZSIsIlBsYXllciIsImNwdVBsYXllciIsIkRPTUxvZ2ljIiwiVUlMb2dpYyIsIm5vZGVzIiwiZ2FtZUluZm8iLCJwbGF5ZXIxQ29vcmRzIiwicGxheWVyMkNvb3JkcyIsImF0dGFja0NwdSIsImF0dGFja09uQ2xpY2siLCJzaGlwQ29vcmRzIiwibm9kZUNvb3JkIiwiYXR0YWNrRnVuY3Rpb24iLCJ2YWx1ZXMiLCJjdXJyZW50Q29vcmRzIiwibWlzc2VkQXR0YWNrT25DbGljayIsImRldGVjdEF0dGFja3MiLCJlIiwicGFyZW50Q2xhc3MiLCJwYXJlbnRFbGVtZW50IiwiY2xhc3NOYW1lIiwibm9kZUNsYXNzIiwiY2xhc3NDb29yZCIsImFycmF5Q29vcmQiLCJ4Iiwic2xpY2UiLCJ5IiwiTnVtYmVyIiwiY2xhc3NUb0FycmF5IiwiY2xlYW5Db29yZHMiLCJmaWx0ZXIiLCJ1bmRlZmluZWQiLCJhZGRFdmVudExpc3RlbmVyIiwib25jZSIsInN0YXJ0R2FtZSIsImdyaWRDb250YWluZXIxIiwiZ3JpZENvbnRhaW5lcjIiLCJjdXJyZW50R2FtZSIsImNoaWxkTm9kZXMiLCJkaXNwbGF5R3JpZCIsImdyaWQxIiwiZ3JpZDIiLCJzaXplIiwicmVjdXJzaXZlIiwieVBvcyIsImdyaWRFbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImdyaWRFbGVtZW50MiIsImFwcGVuZENoaWxkIiwiY3JlYXRlR3JpZCIsImdlbkRPTUVsZW1lbnRzIiwiY2hhbmdlQ29vcmRDb2xvciIsImdyaWROdW1iZXIiLCJjdXJyZW50Q29vcmQiLCJzdHlsZSIsImJvcmRlciIsImdlbkdyaWQiLCJwbGF5ZXJJbmRleCIsImdyaWRzQ29udGFpbmVyIiwibWFpbiIsInF1ZXJ5U2VsZWN0b3IiLCJncmlkIiwiY29vcmRzQXJyIiwib25lRGltZW5zaW9uQ29vcmRzIiwiZmxhdENvb3JkcyIsInNob3dTaGlwcyIsImRlbGV0ZUVsZW1lbnRzIiwicmVtb3ZlIiwiZ2VuU3RhcnRCdXR0b24iLCJzdGFydEJ1dHRvbiIsImVuZEdhbWUiLCJ3aW5uZXIiLCJwbGF5ZXIxR3JpZCIsInBsYXllcjJHcmlkIiwicmVwbGFjZVdpdGgiLCJjbG9uZU5vZGUiLCJFeGFtcGxlQ29vcmRzIiwiZ2VuRE9NIiwic2luZ2xlUGxheWVyIiwibmV3R2FtZSIsInBsYXllck9iaiIsImNwdU9iaiIsImN1cnJlbnRUdXJuIiwicGxheWVyMSIsInBsYXllcjIiLCJwbGF5ZXIxU2hpcHMiLCJwbGF5ZXIyU2hpcHMiLCJwbGF5ZXIyQXR0YWNrc0NvdW50IiwidHVybnNMb2dpYyIsImlzR2FtZU92ZXIiLCJnYW1lVHVybnMiLCJnYW1lVHVybiIsInRvQXR0YWNrR3JpZCIsInR1cm5Mb29wIiwic2V0dXBET00iXSwic291cmNlUm9vdCI6IiJ9